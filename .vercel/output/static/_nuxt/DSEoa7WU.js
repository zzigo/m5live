var Y=Object.defineProperty;var X=(g,o,t)=>o in g?Y(g,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[o]=t;var $=(g,o,t)=>(X(g,typeof o!="symbol"?o+"":o,t),t);import{g as J,r as ee}from"./Dv6OuOwg.js";import{_ as j,r as q,o as te,K as ne,t as G,v as W,x as n,U as oe,V as se,A as ae,L as re,B as p,P as ie,T as le}from"./DdQN4F8u.js";var ue=ee();const V=J(ue);var R={exports:{}},U;function ce(){return U||(U=1,function(g,o){ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(t,s,u){var i=t("../lib/oop"),a=t("./text_highlight_rules").TextHighlightRules,e=function(){var r="and|as|assert|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|raise|return|try|while|with|yield|async|await|nonlocal",c="True|False|None|NotImplemented|Ellipsis|__debug__",l="abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|binfile|bin|iter|property|tuple|bool|filter|len|range|type|bytearray|float|list|raw_input|unichr|callable|format|locals|reduce|unicode|chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|__import__|complex|hash|min|apply|delattr|help|next|setattr|set|buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern|ascii|breakpoint|bytes",m=this.createKeywordMapper({"invalid.deprecated":"debugger","support.function":l,"variable.language":"self|cls","constant.language":c,keyword:r},"identifier"),d="[uU]?",h="[rR]",f="[fF]",k="(?:[rR][fF]|[fF][rR])",v="(?:(?:[1-9]\\d*)|(?:0))",y="(?:0[oO]?[0-7]+)",w="(?:0[xX][\\dA-Fa-f]+)",C="(?:0[bB][01]+)",S="(?:"+v+"|"+y+"|"+w+"|"+C+")",M="(?:[eE][+-]?\\d+)",b="(?:\\.\\d+)",O="(?:\\d+)",F="(?:(?:"+O+"?"+b+")|(?:"+O+"\\.))",T="(?:(?:"+F+"|"+O+")"+M+")",P="(?:"+T+"|"+F+")",E=`\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})`;this.$rules={start:[{token:"comment",regex:"#.*$"},{token:"string",regex:d+'"{3}',next:"qqstring3"},{token:"string",regex:d+'"(?=.)',next:"qqstring"},{token:"string",regex:d+"'{3}",next:"qstring3"},{token:"string",regex:d+"'(?=.)",next:"qstring"},{token:"string",regex:h+'"{3}',next:"rawqqstring3"},{token:"string",regex:h+'"(?=.)',next:"rawqqstring"},{token:"string",regex:h+"'{3}",next:"rawqstring3"},{token:"string",regex:h+"'(?=.)",next:"rawqstring"},{token:"string",regex:f+'"{3}',next:"fqqstring3"},{token:"string",regex:f+'"(?=.)',next:"fqqstring"},{token:"string",regex:f+"'{3}",next:"fqstring3"},{token:"string",regex:f+"'(?=.)",next:"fqstring"},{token:"string",regex:k+'"{3}',next:"rfqqstring3"},{token:"string",regex:k+'"(?=.)',next:"rfqqstring"},{token:"string",regex:k+"'{3}",next:"rfqstring3"},{token:"string",regex:k+"'(?=.)",next:"rfqstring"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|@|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"punctuation",regex:",|:|;|\\->|\\+=|\\-=|\\*=|\\/=|\\/\\/=|%=|@=|&=|\\|=|^=|>>=|<<=|\\*\\*="},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]\\)\\}]"},{token:["keyword","text","entity.name.function"],regex:"(def|class)(\\s+)([\\u00BF-\\u1FFF\\u2C00-\\uD7FF\\w]+)"},{token:"text",regex:"\\s+"},{include:"constants"}],qqstring3:[{token:"constant.language.escape",regex:E},{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],qstring3:[{token:"constant.language.escape",regex:E},{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],qqstring:[{token:"constant.language.escape",regex:E},{token:"string",regex:"\\\\$",next:"qqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:E},{token:"string",regex:"\\\\$",next:"qstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}],rawqqstring3:[{token:"string",regex:'"{3}',next:"start"},{defaultToken:"string"}],rawqstring3:[{token:"string",regex:"'{3}",next:"start"},{defaultToken:"string"}],rawqqstring:[{token:"string",regex:"\\\\$",next:"rawqqstring"},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],rawqstring:[{token:"string",regex:"\\\\$",next:"rawqstring"},{token:"string",regex:"'|$",next:"start"},{defaultToken:"string"}],fqqstring3:[{token:"constant.language.escape",regex:E},{token:"string",regex:'"{3}',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqstring3:[{token:"constant.language.escape",regex:E},{token:"string",regex:"'{3}",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqqstring:[{token:"constant.language.escape",regex:E},{token:"string",regex:"\\\\$",next:"fqqstring"},{token:"string",regex:'"|$',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqstring:[{token:"constant.language.escape",regex:E},{token:"string",regex:"'|$",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqqstring3:[{token:"string",regex:'"{3}',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqstring3:[{token:"string",regex:"'{3}",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqqstring:[{token:"string",regex:"\\\\$",next:"rfqqstring"},{token:"string",regex:'"|$',next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],rfqstring:[{token:"string",regex:"'|$",next:"start"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"},{defaultToken:"string"}],fqstringParRules:[{token:"paren.lparen",regex:"[\\[\\(]"},{token:"paren.rparen",regex:"[\\]\\)]"},{token:"string",regex:"\\s+"},{token:"string",regex:"'[^']*'"},{token:"string",regex:'"[^"]*"'},{token:"function.support",regex:"(!s|!r|!a)"},{include:"constants"},{token:"paren.rparen",regex:"}",next:"pop"},{token:"paren.lparen",regex:"{",push:"fqstringParRules"}],constants:[{token:"constant.numeric",regex:"(?:"+P+"|\\d+)[jJ]\\b"},{token:"constant.numeric",regex:P},{token:"constant.numeric",regex:S+"[lL]\\b"},{token:"constant.numeric",regex:S+"\\b"},{token:["punctuation","function.support"],regex:"(\\.)([a-zA-Z_]+)\\b"},{token:m,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"}]},this.normalizeRules()};i.inherits(e,a),s.PythonHighlightRules=e}),ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"],function(t,s,u){var i=t("../../lib/oop"),a=t("./fold_mode").FoldMode,e=s.FoldMode=function(r){this.foldingStartMarker=new RegExp("([\\[{])(?:\\s*)$|("+r+")(?:\\s*)(?:#.*)?$")};i.inherits(e,a),(function(){this.getFoldWidgetRange=function(r,c,l){var m=r.getLine(l),d=m.match(this.foldingStartMarker);if(d)return d[1]?this.openingBracketBlock(r,d[1],l,d.index):d[2]?this.indentationBlock(r,l,d.index+d[2].length):this.indentationBlock(r,l)}}).call(e.prototype)}),ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"],function(t,s,u){var i=t("../lib/oop"),a=t("./text").Mode,e=t("./python_highlight_rules").PythonHighlightRules,r=t("./folding/pythonic").FoldMode,c=t("../range").Range,l=function(){this.HighlightRules=e,this.foldingRules=new r("\\:"),this.$behaviour=this.$defaultBehaviour};i.inherits(l,a),(function(){this.lineCommentStart="#",this.$pairQuotesAfter={"'":/[ruf]/i,'"':/[ruf]/i},this.getNextLineIndent=function(d,h,f){var k=this.$getIndent(h),v=this.getTokenizer().getLineTokens(h,d),y=v.tokens;if(y.length&&y[y.length-1].type=="comment")return k;if(d=="start"){var w=h.match(/^.*[\{\(\[:]\s*$/);w&&(k+=f)}return k};var m={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(d,h,f){if(f!==`\r
`&&f!=="\r"&&f!==`
`)return!1;var k=this.getTokenizer().getLineTokens(h.trim(),d).tokens;if(!k)return!1;do var v=k.pop();while(v&&(v.type=="comment"||v.type=="text"&&v.value.match(/^\s+$/)));return v?v.type=="keyword"&&m[v.value]:!1},this.autoOutdent=function(d,h,f){f+=1;var k=this.$getIndent(h.getLine(f)),v=h.getTabString();k.slice(-v.length)==v&&h.remove(new c(f,k.length-v.length,f,k.length))},this.$id="ace/mode/python",this.snippetFileId="ace/snippets/python"}).call(l.prototype),s.Mode=l}),function(){ace.require(["ace/mode/python"],function(t){g&&(g.exports=t)})}()}(R)),R.exports}ce();var L={exports:{}},z;function pe(){return z||(z=1,function(g,o){(function(){ace.require(["ace/mode/text"],function(t){g&&(g.exports=t)})})()}(L)),L.exports}pe();var B={exports:{}},H;function de(){return H||(H=1,function(g,o){ace.define("ace/theme/monokai-css",["require","exports","module"],function(t,s,u){u.exports=`.ace-monokai .ace_gutter {
  background: #2F3129;
  color: #8F908A
}

.ace-monokai .ace_print-margin {
  width: 1px;
  background: #555651
}

.ace-monokai {
  background-color: #272822;
  color: #F8F8F2
}

.ace-monokai .ace_cursor {
  color: #F8F8F0
}

.ace-monokai .ace_marker-layer .ace_selection {
  background: #49483E
}

.ace-monokai.ace_multiselect .ace_selection.ace_start {
  box-shadow: 0 0 3px 0px #272822;
}

.ace-monokai .ace_marker-layer .ace_step {
  background: rgb(102, 82, 0)
}

.ace-monokai .ace_marker-layer .ace_bracket {
  margin: -1px 0 0 -1px;
  border: 1px solid #49483E
}

.ace-monokai .ace_marker-layer .ace_active-line {
  background: #202020
}

.ace-monokai .ace_gutter-active-line {
  background-color: #272727
}

.ace-monokai .ace_marker-layer .ace_selected-word {
  border: 1px solid #49483E
}

.ace-monokai .ace_invisible {
  color: #52524d
}

.ace-monokai .ace_entity.ace_name.ace_tag,
.ace-monokai .ace_keyword,
.ace-monokai .ace_meta.ace_tag,
.ace-monokai .ace_storage {
  color: #F92672
}

.ace-monokai .ace_punctuation,
.ace-monokai .ace_punctuation.ace_tag {
  color: #fff
}

.ace-monokai .ace_constant.ace_character,
.ace-monokai .ace_constant.ace_language,
.ace-monokai .ace_constant.ace_numeric,
.ace-monokai .ace_constant.ace_other {
  color: #AE81FF
}

.ace-monokai .ace_invalid {
  color: #F8F8F0;
  background-color: #F92672
}

.ace-monokai .ace_invalid.ace_deprecated {
  color: #F8F8F0;
  background-color: #AE81FF
}

.ace-monokai .ace_support.ace_constant,
.ace-monokai .ace_support.ace_function {
  color: #66D9EF
}

.ace-monokai .ace_fold {
  background-color: #A6E22E;
  border-color: #F8F8F2
}

.ace-monokai .ace_storage.ace_type,
.ace-monokai .ace_support.ace_class,
.ace-monokai .ace_support.ace_type {
  font-style: italic;
  color: #66D9EF
}

.ace-monokai .ace_entity.ace_name.ace_function,
.ace-monokai .ace_entity.ace_other,
.ace-monokai .ace_entity.ace_other.ace_attribute-name,
.ace-monokai .ace_variable {
  color: #A6E22E
}

.ace-monokai .ace_variable.ace_parameter {
  font-style: italic;
  color: #FD971F
}

.ace-monokai .ace_string {
  color: #E6DB74
}

.ace-monokai .ace_comment {
  color: #75715E
}

.ace-monokai .ace_indent-guide {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ0FD0ZXBzd/wPAAjVAoxeSgNeAAAAAElFTkSuQmCC) right repeat-y
}

.ace-monokai .ace_indent-guide-active {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQIW2PQ1dX9zzBz5sz/ABCcBFFentLlAAAAAElFTkSuQmCC) right repeat-y;
}
`}),ace.define("ace/theme/monokai",["require","exports","module","ace/theme/monokai-css","ace/lib/dom"],function(t,s,u){s.isDark=!0,s.cssClass="ace-monokai",s.cssText=t("./monokai-css");var i=t("../lib/dom");i.importCssString(s.cssText,s.cssClass,!1)}),function(){ace.require(["ace/theme/monokai"],function(t){g&&(g.exports=t)})}()}(B)),B.exports}de();const me={__name:"AceEditor",props:{mode:{type:String,default:"editor"},value:{type:String,default:""}},emits:["evaluate","evaluateTS","keydown","input"],setup(g,{expose:o,emit:t}){const s=g,u=t,i=q(null),a=q(null),e=q(null),r=q(null),c=()=>{V.define("ace/mode/musicv",["require","exports","ace/lib/oop","ace/mode/text","ace/mode/musicv_highlight_rules"],(l,m)=>{const d=l("ace/lib/oop"),h=l("ace/mode/text").Mode,f=l("ace/mode/musicv_highlight_rules").MusicVHighlightRules,k=function(){this.HighlightRules=f};d.inherits(k,h),k.prototype.lineCommentStart="COM ",k.prototype.toggleCommentLines=function(v,y,w,C){const S=/^(?:\s*)(?:COM |COMMENT |COMMENT: )/;let M=!0;for(let b=w;b<=C;b++)if(!S.test(y.getLine(b))){M=!1;break}if(M)for(let b=w;b<=C;b++){const F=y.getLine(b).match(S);F&&y.replace(new V.Range(b,F.index,b,F[0].length),"")}else y.indentRows(w,C,"COM ")},m.Mode=k}),V.define("ace/mode/musicv_highlight_rules",["require","exports","ace/lib/oop","ace/mode/text_highlight_rules"],(l,m)=>{const d=l("ace/lib/oop"),h=l("ace/mode/text_highlight_rules").TextHighlightRules,f=function(){this.$rules={start:[{token:"comment",regex:"^\\s*(?:COM|COMMENT|COMMENT:)\\s.*$"},{token:"keyword.gen",regex:"\\b(GEN)\\b"},{token:"keyword",regex:"\\b(INS|OSC|OUT|END|NOT|TER)\\b"},{token:"constant.numeric",regex:"\\b[0-9]+(?:\\.[0-9]+)?\\b"}]},this.normalizeRules()};d.inherits(f,h),m.MusicVHighlightRules=f})};return te(()=>{if(console.log("Mounting AceEditor, ref:",i.value),!i.value){console.error("Editor ref not found");return}c(),e.value=V.edit(i.value,{theme:"ace/theme/monokai",mode:s.mode==="editor"?"ace/mode/musicv":"ace/mode/text",fontSize:s.mode==="terminal"?8:10,showPrintMargin:!1,highlightActiveLine:s.mode==="editor",readOnly:s.mode==="terminal",showGutter:s.mode==="editor",wrap:!0,fontFamily:"'Web437_IBM_MDA', monospace",value:s.value}),console.log("Ace Editor initialized:",e.value),s.mode==="editor"&&(e.value.commands.addCommand({name:"evaluateTS",bindKey:{win:"Alt-Enter",mac:"Alt-Enter"},exec:()=>u("evaluateTS",e.value.getValue())}),e.value.commands.addCommand({name:"evaluateBinary",bindKey:{win:"Ctrl-Enter",mac:"Ctrl-Enter"},exec:()=>u("evaluate",e.value.getValue())}),e.value.commands.removeCommand("gotoline"),e.value.commands.bindKey("ctrl-p",null),e.value.commands.bindKey("Alt-Shift-Left",null),e.value.commands.bindKey("Alt-Shift-Right",null),e.value.container.addEventListener("keydown",l=>u("keydown",l))),e.value.on("change",()=>u("input",e.value.getValue())),r.value=new ResizeObserver(()=>{var l;return(l=e.value)==null?void 0:l.resize()}),a.value&&r.value.observe(a.value)}),ne(()=>{r.value&&r.value.disconnect(),e.value&&e.value.destroy()}),o({addToEditor:l=>{var m;return(m=e.value)==null?void 0:m.setValue(l,-1)},addTerminalOutput:l=>{if(s.mode==="terminal"&&e.value){const m=e.value.getValue();e.value.setValue(m?`${m}
${l}`:l),e.value.navigateFileEnd()}},aceEditor:()=>e.value,resize:()=>{var l;return(l=e.value)==null?void 0:l.resize()},clearEditor:()=>{var l;return(l=e.value)==null?void 0:l.setValue("")},clearTerminal:()=>{var l;return s.mode==="terminal"&&((l=e.value)==null?void 0:l.setValue(""))}}),(l,m)=>(W(),G("div",{class:"ace-editor-container",ref_key:"editorContainer",ref:a},[n("div",{class:oe(["editor",{editor:g.mode==="editor",terminal:g.mode==="terminal"}]),ref_key:"editorRef",ref:i},null,2)],512))}},xe=j(me,[["__scopeId","data-v-7553e65f"]]),he={class:"modal-header"},ge={__name:"HelpModal",props:{modelValue:Boolean},emits:["update:modelValue"],setup(g){return(o,t)=>(W(),se(le,{name:"modal"},{default:ae(()=>[g.modelValue?(W(),G("div",{key:0,class:"modal-overlay",onClick:t[2]||(t[2]=s=>o.$emit("update:modelValue",!1))},[n("div",{class:"modal-content",onClick:t[1]||(t[1]=ie(()=>{},["stop"]))},[n("div",he,[t[3]||(t[3]=n("h2",null,"Welcome to M5LIVE",-1)),n("button",{class:"close-button",onClick:t[0]||(t[0]=s=>o.$emit("update:modelValue",!1))},"×")]),t[4]||(t[4]=n("div",{class:"modal-body"},[n("h3",null,"A LiveCoding Revival of MUSIC V"),n("p",null," M5LIVE is a modern reinterpretation of Max Mathews' pioneering MUSIC V system, enabling live coding of musical scores in the MUSIC V syntax. Built on Nuxt 3, it bridges vintage computer music with contemporary web technologies, offering a platform to explore sound synthesis and speculative instrument design. "),n("h4",null,"Historical Context: Max Mathews and MUSIC I-VI"),n("p",null,' Max Mathews, often called the "father of computer music," invented the MUSIC series (I-VI) starting in 1957 at Bell Labs. MUSIC I was the first program to synthesize sound on a computer (an IBM 704), famously rendering "Daisy Bell" in 1961—later immortalized in *2001: A Space Odyssey*. By MUSIC V (1968), Mathews introduced a modular, score-based system that abstracted sound generation into "instruments" (unit generators) and "notes," laying the groundwork for modern digital audio workstations. Through a media archaeology lens, MUSIC V reveals deep patterns in computational design—modularity, abstraction, and human-machine collaboration—that resonate with philosophical questions about creativity and interface incentives. M5LIVE recovers these patterns, extending them into a web-based, interactive environment. '),n("h4",null,"How It Works:"),n("ol",null,[n("li",null,[p("Write MUSIC V scores in the editor (e.g., "),n("code",null,"INS 0 1; OSC P5 P6 B2 F2 P30;"),p(").")]),n("li",null,"Use shortcuts to evaluate code live or send it to the console."),n("li",null,"Explore stored scores via the storage menu, updating or playing them as TypeScript audio."),n("li",null,"Leverage media archaeology to rediscover design paradigms from Mathews' era, inspiring new interfaces.")]),n("h4",null,"Activated Commands:"),n("ul",null,[n("li",null,[n("strong",null,"Evaluate/Stop TS"),p(": "),n("kbd",null,"Alt + Enter"),p(" - Runs the selected or full score as TypeScript audio. When playing, changes to a stop button. Syntax: "),n("code",null,"INS <time> <duration>; OSC <params>; OUT <buffer>; END;")]),n("li",null,[n("strong",null,"Stop Playback"),p(": "),n("kbd",null,"Cmd + ."),p(" or "),n("kbd",null,"Ctrl + ."),p(" - Stops audio playback.")]),n("li",null,[n("strong",null,"Evaluate Binary"),p(": "),n("kbd",null,"Ctrl + Enter"),p(" - Will execute the score using original Fortran MUSIC V binary compilation (future implementation).")]),n("li",null,[n("strong",null,"Clear Editor"),p(": "),n("kbd",null,"Ctrl + H"),p(" - Wipes the editor content.")]),n("li",null,[n("strong",null,"Clear Console"),p(": "),n("kbd",null,"Ctrl + P"),p(" - Clears the console output.")]),n("li",null,[n("strong",null,"Storage Menu"),p(": "),n("kbd",null,"Ctrl + M"),p(" - Opens the storage menu for saved codes.")]),n("li",null,[n("strong",null,"Navigate Codes"),p(": "),n("kbd",null,"Alt + Shift + ←/→"),p(" - Navigate between saved codes.")]),n("li",null,[n("strong",null,"Show/Hide Code"),p(": Click the eye icon - Toggles visibility of generated code.")]),n("li",null,[n("strong",null,"Mobile Evaluate"),p(': Tap "Evaluate" button - Triggers evaluation on mobile devices.')])]),n("h4",null,"Future Implementations:"),n("ul",null,[n("li",null,[n("strong",null,"Save Session"),p(": "),n("kbd",null,"Ctrl + S"),p(" - Save current session to local storage.")]),n("li",null,[n("strong",null,"Load Preset"),p(": "),n("kbd",null,"Ctrl + L"),p(" - Load predefined MUSIC V presets.")]),n("li",null,[n("strong",null,"Visualize Waveform"),p(": "),n("kbd",null,"Ctrl + W"),p(" - Display real-time waveform of generated audio.")]),n("li",null,[n("strong",null,"Export WAV"),p(": "),n("kbd",null,"Ctrl + E"),p(" - Export audio as a WAV file.")]),n("li",null,[n("strong",null,"Speculative Synth"),p(": Combine MUSIC V with organogram-style instrument design for hybrid sound generation.")])]),n("h4",null,"Operation Codes (Future Implementation):"),n("ul",null,[n("li",null,[n("strong",null,"INS"),p(" - Define an instrument")]),n("li",null,[n("strong",null,"OSC"),p(" - Create an oscillator")]),n("li",null,[n("strong",null,"OUT"),p(" - Define output routing")]),n("li",null,[n("strong",null,"END"),p(" - End instrument definition")]),n("li",null,[n("strong",null,"GEN"),p(" - Generate function table")]),n("li",null,[n("strong",null,"NOT"),p(" - Define a note event")]),n("li",null,[n("strong",null,"TER"),p(" - Terminate score")]),n("li",null,[n("strong",null,"ADD"),p(" - Add signals")]),n("li",null,[n("strong",null,"MUL"),p(" - Multiply signals")]),n("li",null,[n("strong",null,"ENV"),p(" - Create envelope")]),n("li",null,[n("strong",null,"FLT"),p(" - Apply filter")]),n("li",null,[n("strong",null,"DEL"),p(" - Create delay")]),n("li",null,[n("strong",null,"REV"),p(" - Apply reverb")]),n("li",null,[n("strong",null,"COM"),p(" - Add comment")])]),n("h4",null,"Shortcuts:"),n("ul",null,[n("li",null,[n("kbd",null,"Alt + Enter"),p(": Evaluate TypeScript audio / Start playback")]),n("li",null,[n("kbd",null,"Cmd + ."),p(" or "),n("kbd",null,"Ctrl + ."),p(": Stop playback")]),n("li",null,[n("kbd",null,"Ctrl + Enter"),p(": Evaluate binary audio")]),n("li",null,[n("kbd",null,"Ctrl + H"),p(": Clear editor")]),n("li",null,[n("kbd",null,"Ctrl + P"),p(": Clear console")]),n("li",null,[n("kbd",null,"Ctrl + M"),p(": Open storage menu")]),n("li",null,[n("kbd",null,"Alt + Shift + ←/→"),p(": Navigate between saved codes")]),n("li",null,[n("kbd",null,"Ctrl + S"),p(": Save session (future)")]),n("li",null,[n("kbd",null,"Ctrl + L"),p(": Load preset (future)")]),n("li",null,[n("kbd",null,"Ctrl + W"),p(": Show waveform (future)")]),n("li",null,[n("kbd",null,"Ctrl + E"),p(": Export WAV (future)")])]),n("p",{class:"tip"},[n("strong",null,"Tip:"),p(" Start with a simple score like "),n("code",null,"INS 0 1; OSC P5 P6 B2 F2 P30; OUT B2 B1; END;"),p(" to hear a basic oscillator output, then experiment with parameters. ")]),n("div",{class:"reference"},[n("h4",null,"Media Archaeology & Design Insights"),n("p",null," Mathews' MUSIC V series, explored through media archaeology, uncovers a philosophical shift: music as code, not just sound. Its unit-generator model prefigures modular synths and DAWs, offering interface-design incentives—intuitive control over abstract processes. M5LIVE extends this legacy, merging historical patterns with modern web interactivity to inspire new sonic explorations. ")]),n("div",{class:"credits"},[n("h4",null,"Academic Attribution"),n("p",null," M5LIVE is a research project by Luciano Azzigotti, inspired by Max Mathews' MUSIC V and media archaeological principles, developed within a broader study of speculative sound design. ")])],-1))])])):re("",!0)]),_:1}))}},be=j(ge,[["__scopeId","data-v-c4dc3b66"]]);function ye(){function g(u){if(!u||typeof u!="string")return u;const i=u.split(`
`),a=[];for(let e of i){const r=e.trim();if(!r||r.startsWith("COM")||r.startsWith("COMMENT")){a.push(e);continue}if(r.startsWith("GEN")){a.push(o(e));continue}if(r.startsWith("NOT")){a.push(t(e));continue}a.push(e)}return a.join(`
`)}function o(u){const a=u.split(/\s+/).slice(0,3).join(" "),e=Math.floor(Math.random()*7)+2,r=[];r.push({time:0,value:Math.random()*2-1});for(let l=1;l<e-1;l++)r.push({time:Math.floor(l/(e-1)*511),value:Math.random()*2-1});r.push({time:511,value:Math.random()*2-1}),r.sort((l,m)=>l.time-m.time);const c=r.map(l=>`${l.value.toFixed(3)} ${l.time}`).join(" ");return`${a} ${c};`}function t(u){const a=u.split(/\s+/).slice(0,3).join(" "),e=(Math.random()*.5+.1).toFixed(2),r=Math.floor(Math.random()*1e3+100),c=(Math.random()*8+1).toFixed(2);return`${a} ${e} ${r} ${c};`}async function s(){try{const i=await(await fetch("/prompts.json")).json();return i[Math.floor(Math.random()*i.length)]}catch(u){return console.error("Error loading prompts:",u),"Imagine a novel musical instrument that combines traditional acoustics with objects from technic or nature..."}}return{getRandomPrompt:s,randomizeScore:g}}function Ie(){const g=q(null);let o=null,t=null;const s=()=>{g.value=document.querySelector("link[rel*='icon']"),g.value||(g.value=document.createElement("link"),g.value.type="image/x-icon",g.value.rel="shortcut icon",document.head.appendChild(g.value))},u=e=>{const r=document.createElement("canvas");r.width=32,r.height=32;const c=r.getContext("2d");if(!c)return"";c.fillRect(0,0,32,32),c.lineWidth=2.5,c.strokeStyle=e;const l=e.match(/[\d.]+\)$/),m=l?parseFloat(l[0]):1,h=Math.max(1,7+(1-m)*1.5),f=16,k=10,v=16;return c.beginPath(),c.arc(v-k/2,f,h,0,2*Math.PI),c.stroke(),c.beginPath(),c.arc(v+k/2,f,h,0,2*Math.PI),c.stroke(),r.toDataURL()};return{startProcessing:()=>{if(s(),!g.value)return;let e=1,r=!1;o&&clearInterval(o),t&&clearTimeout(t),o=setInterval(()=>{r?(e+=.1,e>=1&&(e=1,r=!1)):(e-=.1,e<=.3&&(e=.3,r=!0));const c=`rgba(200, 0, 0, ${e})`;g.value&&(g.value.href=u(c))},50)},completeProcessing:()=>{if(!g.value)return;o&&(clearInterval(o),o=null),g.value.href=u("#00ff00");let e=1;t&&clearTimeout(t),t=setTimeout(()=>{const r=setInterval(()=>{if(e-=.1,e<=0){clearInterval(r),g.value&&(g.value.href=u("#ffffff"));return}const c=`rgba(0, 255, 0, ${e})`;g.value&&(g.value.href=u(c))},50)},500)}}}class we{constructor(){$(this,"sampleRate",44100);$(this,"parameters",new Float32Array(1e3));$(this,"events",[]);$(this,"currentTime",0);$(this,"instruments",new Map);$(this,"functions",new Map);$(this,"currentInstrument",null);$(this,"audioContext",null);$(this,"workletNode",null);$(this,"consoleOutput","");$(this,"isServer",typeof globalThis.window>"u");$(this,"activeNotes",new Map);$(this,"pass2Report",[]);$(this,"globalVars",new Map);this.initDefaultFunctionTables(),this.isServer||this.setupKeyboardShortcuts()}initDefaultFunctionTables(){const o=new Float32Array(512);for(let s=0;s<512;s++)o[s]=Math.sin(2*Math.PI*s/512);this.functions.set(2,o);const t=new Float32Array(512);for(let s=0;s<512;s++)t[s]=s/512;this.functions.set(1,t)}setupKeyboardShortcuts(){document.addEventListener("keydown",o=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?o.metaKey&&o.key===".":o.ctrlKey&&o.key===".")&&(o.preventDefault(),this.stopAndReset())})}stopAndReset(){try{this.audioContext?(this.workletNode&&(this.workletNode.port.postMessage({type:"stop"}),this.workletNode.disconnect(),this.workletNode=null),this.audioContext.suspend().then(()=>{this.audioContext.close(),this.audioContext=null,this.activeNotes.clear(),this.events=[],this.currentTime=0,this.consoleOutput="",console.clear(),this.consoleOutput+=`MusicV stopped and reset
`})):(this.activeNotes.clear(),this.events=[],this.currentTime=0,this.consoleOutput="",console.clear(),this.consoleOutput+=`MusicV reset
`)}catch(o){console.error("Error during stop and reset:",o),this.consoleOutput+=`Error during stop and reset: ${o.message}
`}}parseScore(o){this.consoleOutput=`*** MUSIC V SCORE PROCESSING ***

`,this.events=[],this.instruments.clear(),this.pass2Report=[],this.activeNotes.clear(),this.globalVars.clear();const t=o.split(`
`);let s=-1;const u=new Map;for(let i=0;i<t.length;i++){const a=t[i];if(!a.trim()||a.trim().startsWith(";"))continue;if(a.trim().startsWith("COM")||a.trim().startsWith("COMMENT")){this.consoleOutput+=`Comment: ${a.trim().substring(a.indexOf(" ")+1)}
`;continue}const e=a.trim().split(/\s+/),r=e[0],c=`${r.padEnd(8)}${e.slice(1).map(l=>l.padEnd(9," ")).join("")}`;switch(this.pass2Report.push(c),r){case"INS":this.currentInstrument&&(this.consoleOutput+=`Instrument ${s} definition complete

`,u.set(s,this.currentInstrument.units.length),this.pass2Report.push(`       ${s}    ${this.currentInstrument.units.length}.000    0.000`)),parseFloat(e[1]),s=parseInt(e[2],10),this.currentInstrument={id:s,units:[],oscillators:[],outputs:[]},this.instruments.set(s,this.currentInstrument),this.consoleOutput+=`Defining Instrument ${s}
`;break;case"OSC":if(this.currentInstrument){const x=e[1],I=e[2],A=parseInt(e[3].substring(1),10),_=parseInt(e[4].substring(1),10),N=e[5]||"P30",Z=this.currentInstrument.oscillators.length+1;this.currentInstrument.oscillators.push({id:Z,type:1,freqParam:x,ampParam:I,outputBus:A,functionTable:_,phaseParam:N}),this.currentInstrument.units.push({type:"OSC",params:{freqParam:x,ampParam:I,outputBlock:A,functionNum:_,phaseParam:N}}),this.consoleOutput+=`  OSC: Freq=${x}, Amp=${I}, Out=B${A}, Func=F${_}, Phase=${N}
`}break;case"OUT":if(this.currentInstrument){const x=parseInt(e[1].substring(1),10),I=parseInt(e[2].substring(1),10);this.currentInstrument.outputs.push({inputBus:x,outputBus:I}),this.currentInstrument.units.push({type:"OUT",params:{inputBlock:x,outputBlock:I,amplitude:1}}),this.consoleOutput+=`  OUT: In=B${x}, Out=B${I}, Amp=1
`}break;case"AD2":if(this.currentInstrument){const x=e[1].startsWith("P")?e[1]:parseInt(e[1].substring(1),10),I=e[2].startsWith("P")?e[2]:parseInt(e[2].substring(1),10),A=parseInt(e[3].substring(1),10);this.currentInstrument.units.push({type:"AD2",params:{input1:x,input2:I,outputBlock:A}}),this.consoleOutput+=`  AD2: In1=${x}, In2=${I}, Out=B${A}
`}break;case"SET":if(this.currentInstrument){const x=e[1];this.currentInstrument.units.push({type:"SET",params:{param:x}}),this.consoleOutput+=`  SET: Param=${x}
`}break;case"MLT":if(this.currentInstrument){const x=e[1].startsWith("P")?e[1]:parseInt(e[1].substring(1),10),I=e[2].startsWith("P")?e[2]:parseInt(e[2].substring(1),10),A=parseInt(e[3].substring(1),10);this.currentInstrument.units.push({type:"MLT",params:{input1:x,input2:I,outputBlock:A}}),this.consoleOutput+=`  MLT: In1=${x}, In2=${I}, Out=B${A}
`}break;case"ENV":if(this.currentInstrument){const x=e[1],I=e[2],A=parseInt(e[3].substring(1),10),_=parseInt(e[4].substring(1),10),N=e[5]||"P30";this.currentInstrument.units.push({type:"ENV",params:{ampParam:x,durParam:I,outputBlock:A,functionNum:_,phaseParam:N}}),this.consoleOutput+=`  ENV: Amp=${x}, Dur=${I}, Out=B${A}, Func=F${_}, Phase=${N}
`}break;case"SIA":const l=parseFloat(e[1]),m=parseInt(e[2],10),d=parseInt(e[3],10);this.globalVars.set(m,d),m===4&&(this.sampleRate=d),this.events.push({type:"sia",time:l,varNum:m,value:d}),this.consoleOutput+=`SIA: Time=${l}, Var=${m}, Value=${d} (SampleRate=${this.sampleRate})
`;break;case"SV2":const h=parseFloat(e[1]),f=parseInt(e[2],10),k=parseFloat(e[3]);this.events.push({type:"sv2",time:h,varNum:f,value:k}),this.consoleOutput+=`SV2: Time=${h}, Var=P${f}, Value=${k}
`;break;case"END":this.currentInstrument&&(this.consoleOutput+=`Instrument ${s} definition complete

`,u.set(s,this.currentInstrument.units.length),this.currentInstrument=null);break;case"GEN":const v=parseInt(e[3],10),y=e.slice(4).map(x=>parseFloat(x));this.handleGenFunction(v,parseInt(e[1]),parseInt(e[2]),y),this.consoleOutput+=`GEN: Function=${v}, Params=${y.length}
`;break;case"NOT":const w=parseFloat(e[1]),C=parseInt(e[2],10),S=parseFloat(e[3]),M=parseFloat(e[4]),b=parseFloat(e[5]),O=e[6]?parseFloat(e[6]):void 0,F=e[7]?parseFloat(e[7]):void 0,T=e[8]?parseFloat(e[8]):void 0;this.events.push({type:"note",time:w,insNum:C,frequency:M,amplitude:S,duration:b,p6:O,p7:F,p8:T}),this.consoleOutput+=`NOTE: Time=${w}, Ins=${C}, Amp=${S}, Freq=${M}, Dur=${b}${O?`, P6=${O}`:""}${F?`, P7=${F}`:""}${T?`, P8=${T}`:""}
`;break;case"TER":const P=parseFloat(e[1]);this.events.push({type:"termination",time:P}),this.consoleOutput+=`Termination time: ${P}

`;break;case"PLF":const E=parseFloat(e[1]),D=parseInt(e[2],10),K=parseInt(e[3],10),Q=e.slice(4).map(x=>parseFloat(x));D===3?this.handlePLF3(E,K,Q,t,i):this.consoleOutput+=`PLF: Unsupported subroutine ${D} (only PLF3 implemented)
`;break;case"SV3":this.consoleOutput+=`SV3: Set variable in Pass III (not implemented)
`;break;case"SEC":this.consoleOutput+=`SEC: End section (not implemented)
`;break;case"SV1":this.consoleOutput+=`SV1: Set variable in Pass I (not implemented)
`;break;case"PLS":this.consoleOutput+=`PLS: Execute subroutine in Pass II (not implemented)
`;break;case"SI3":this.consoleOutput+=`SI3: Set integer in Pass III (not implemented)
`;break;case"RAN":this.consoleOutput+=`RAN: Random generator (not implemented)
`;break;case"STR":if(this.currentInstrument){const x=e[1].startsWith("B")?parseInt(e[1].substring(1),10):e[1],I=e[2],A=parseInt(e[3].substring(1),10);this.currentInstrument.units.push({type:"STR",params:{inputBlock:x,varParam:I,outputBlock:A}}),this.consoleOutput+=`  STR: In=${x}, Var=${I}, Out=B${A}
`}break;case"AD3":this.consoleOutput+=`AD3: Three-input adder (not implemented)
`;break;case"AD4":this.consoleOutput+=`AD4: Four-input adder (not implemented)
`;break;case"FLT":this.consoleOutput+=`FLT: Filter (not implemented)
`;break;case"RAH":this.consoleOutput+=`RAH: Random and hold (not implemented)
`;break;case"IOS":this.consoleOutput+=`IOS: Interpolating oscillator (not implemented)
`;break;default:this.consoleOutput+=`Unknown opcode: ${r} (skipped)
`}}this.events.sort((i,a)=>i.time-a.time),this.processPass2()}handlePLF3(o,t,s,u,i){const[a,e,r,c,l]=s;let m=null;for(let M=i+1;M<u.length;M++){const b=u[M].trim();if(b&&!b.startsWith(";")&&b.startsWith("NOT")){m=b;break}}if(!m){this.consoleOutput+=`PLF3: No following NOT card found at time ${o}
`;return}const d=m.split(/\s+/).map(M=>M.trim());parseFloat(d[1]);const h=parseInt(d[2],10),f=parseFloat(d[3]),k=parseFloat(d[4]),v=parseFloat(d[5]),y=d[6]?parseFloat(d[6]):void 0,w=d[7]?parseFloat(d[7]):void 0,C=d[8]?parseFloat(d[8]):void 0;let S=o;for(let M=0;M<a;M++){for(let b=0;b<e;b++){const O=b+1,F=y!==void 0?O*y:void 0,T=F!==void 0?F:v*O,P=h===1?h:2,E=c>0?k*c:k;this.events.push({type:"note",time:S,insNum:P,frequency:E,amplitude:f,duration:T,p6:F,p7:w,p8:C}),this.consoleOutput+=`PLF3: Generated note at ${S}, ins=${P}, freq=${E}, amp=${f}, dur=${T}${F?`, p6=${F}`:""}
`}S+=r}}processPass2(){this.consoleOutput+=`1PASS II REPORT
0(WORD CNT)
`,this.pass2Report.forEach(o=>this.consoleOutput+=`${o}
`),this.instruments.forEach((o,t)=>{this.consoleOutput+=`       ${t.toString().padStart(2)}    ${o.units.length.toFixed(3).padStart(6)}    0.000
`});for(const o of this.events)if(o.type==="sv2"){const{time:t,varNum:s,value:u}=o;for(const i of this.events)if(i.type==="note"&&i.time>=t){switch(s){case 5:i.frequency=u;break;case 6:i.p6=u;break;case 7:i.p7=u;break;case 8:i.p8=u;break;default:this.consoleOutput+=`SV2: Unsupported varNum P${s}
`;break}this.consoleOutput+=`SV2 applied at ${t}s: P${s}=${u} to note at ${i.time}s
`}}this.consoleOutput+=`END OF PASS II

Score processing complete
`}processOscillator(o,t,s,u){var w,C;const{freqParam:i,ampParam:a,outputBlock:e,functionNum:r,phaseParam:c}=o.params,l=i.startsWith("B")?((w=s.get(parseInt(i.substring(1))))==null?void 0:w[0])||0:t[i.toLowerCase()]||t.frequency||440,m=a.startsWith("B")?((C=s.get(parseInt(a.substring(1))))==null?void 0:C[0])||0:t[a.toLowerCase()]||t.amplitude||.5,d=this.functions.get(r)||this.functions.get(2);let h=s.get(e);if(h||(h=new Float32Array(1),s.set(e,h)),!t.oscState){const S=c.startsWith("P")&&t[c.toLowerCase()]||0;t.oscState={sum:S}}const f=d.length,k=l*f/this.sampleRate;t.oscState.sum+=k;const v=Math.floor(t.oscState.sum%(f-1)),y=d[v];h[0]=y*m,i.startsWith("B")&&parseInt(i.substring(1))===e&&(h[0]*=.9)}processOutput(o,t){var r;const{inputBlock:s,outputBlock:u,amplitude:i}=o.params,a=((r=t.get(s))==null?void 0:r[0])||0;let e=t.get(u);e||(e=new Float32Array(1),t.set(u,e)),e[0]+=a*i}processAd2(o,t,s){var m,d;const{input1:u,input2:i,outputBlock:a}=o.params,e=typeof u=="string"?t[u.toLowerCase()]||0:((m=s.get(u))==null?void 0:m[0])||0,r=typeof i=="string"?t[i.toLowerCase()]||0:((d=s.get(i))==null?void 0:d[0])||0,c=e+r;let l=s.get(a);l||(l=new Float32Array(1),s.set(a,l)),l[0]=c}processSet(o,t,s,u){const{param:i}=o.params,a=t[i.toLowerCase()]||0,e=u.findIndex(r=>r===o);for(let r=e+1;r<u.length;r++)if(u[r].type==="OSC"){u[r].params.functionNum=Math.floor(a)||u[r].params.functionNum;break}}processMlt(o,t,s){var m,d;const{input1:u,input2:i,outputBlock:a}=o.params,e=typeof u=="string"?t[u.toLowerCase()]||0:((m=s.get(u))==null?void 0:m[0])||0,r=typeof i=="string"?t[i.toLowerCase()]||0:((d=s.get(i))==null?void 0:d[0])||0,c=e*r;let l=s.get(a);l||(l=new Float32Array(1),s.set(a,l)),l[0]=c}processEnv(o,t,s,u){var w,C;const{ampParam:i,durParam:a,outputBlock:e,functionNum:r,phaseParam:c}=o.params,l=i.startsWith("B")?((w=s.get(parseInt(i.substring(1))))==null?void 0:w[0])||0:t[i.toLowerCase()]||t.amplitude||.5,m=a.startsWith("P")?t[a.toLowerCase()]||t.duration||1:((C=s.get(parseInt(a.substring(1))))==null?void 0:C[0])||t.duration||1,d=this.functions.get(r)||this.functions.get(2);let h=s.get(e);if(h||(h=new Float32Array(1),s.set(e,h)),!t.envState){const S=c.startsWith("P")&&t[c.toLowerCase()]||0;t.envState={time:S}}const f=u-t.startTime,k=Math.min(f/m,1),v=Math.floor(k*(d.length-1)),y=d[v];h[0]=y*l}processStr(o,t,s){var r;const{inputBlock:u,outputBlock:i}=o.params,a=((r=s.get(u))==null?void 0:r[0])||0;let e=s.get(i);e||(e=new Float32Array(1),s.set(i,e)),e[0]+=a}generateSample(o,t){var i;for(let a=2;a<=10;a++){const e=t.get(a);e&&e.fill(0)}for(const[a,e]of this.activeNotes.entries()){const r=e.startTime+e.duration;if(o>=e.startTime&&o<=r){const c=e.instrument;if(c&&c.units)for(const l of c.units)switch(l.type){case"OSC":this.processOscillator(l,e,t,o);break;case"OUT":this.processOutput(l,t);break;case"AD2":this.processAd2(l,e,t);break;case"SET":this.processSet(l,e,t,c.units);break;case"MLT":this.processMlt(l,e,t);break;case"ENV":this.processEnv(l,e,t,o);break;case"STR":this.processStr(l,e,t);break}}else o>r&&this.activeNotes.delete(a)}return(((i=t.get(1))==null?void 0:i[0])||0)*.5}async generateSound(o=8){try{const t=Math.floor(this.sampleRate*o),s=new Float32Array(t);this.currentTime=0;const u=new Map([[1,new Float32Array(1)]]);this.activeNotes.clear();const i=[...this.events];for(let a=0;a<t;a++){const e=a/this.sampleRate;for(;i.length>0&&i[0].time<=e;){const r=i.shift();this.processEvent(r,e)}s[a]=this.generateSample(e,u),this.currentTime=e}return s}catch(t){return console.error("Error generating sound:",t),this.consoleOutput+=`Error generating sound: ${t.message}
`,new Float32Array(0)}}processEvent(o,t){switch(o.type){case"note":const s=this.instruments.get(o.insNum);if(s){const u=Date.now()+Math.random(),i=JSON.parse(JSON.stringify(s));this.activeNotes.set(u,{instrument:i,startTime:t,duration:o.duration,frequency:o.frequency,amplitude:o.amplitude,p6:o.p6,p7:o.p7,p8:o.p8,p29:o.p29,p30:o.p30})}else this.consoleOutput+=`Error: Instrument ${o.insNum} not found
`;break;case"sia":this.globalVars.set(o.varNum,o.value),o.varNum===4&&(this.sampleRate=o.value);break;case"sv2":break;case"termination":this.activeNotes.clear();break}}async initAudio(){if(this.audioContext)this.audioContext.state==="suspended"&&await this.audioContext.resume();else try{if(this.isServer)throw new Error("Cannot initialize audio in server environment");this.audioContext=new AudioContext({sampleRate:this.sampleRate,latencyHint:"interactive"}),this.audioContext.state==="suspended"&&await this.audioContext.resume();const o=["/musicVWorklet.js","./musicVWorklet.js","../musicVWorklet.js","musicVWorklet.js"];let t=!1,s=null;for(const u of o){if(t)break;try{await this.audioContext.audioWorklet.addModule(u),t=!0}catch(i){console.warn(`Failed to load worklet from ${u}:`,i),s=i}}if(!t)throw new Error(`Failed to load worklet from any path: ${(s==null?void 0:s.message)||"Unknown error"}`);this.workletNode=new AudioWorkletNode(this.audioContext,"music-v-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{sampleRate:this.sampleRate}}),this.workletNode.connect(this.audioContext.destination)}catch(o){throw console.error("Failed to initialize audio:",o),this.consoleOutput+=`Failed to initialize audio: ${o.message||"Unknown error"}
`,new Error(`Failed to initialize audio: ${o.message||"Unknown error"}`)}}async play(){try{if(this.audioContext||await this.initAudio(),!this.audioContext||!this.workletNode)throw new Error("Audio system not properly initialized");this.audioContext.state==="suspended"&&await this.audioContext.resume();let o=8;const t=this.events.find(s=>s.type==="termination");t&&(o=t.time),this.workletNode.port.postMessage({type:"play",events:this.events.map(s=>({...s})),currentTime:0,terminationTime:o}),this.consoleOutput+=`Audio playback started
`}catch(o){throw console.error("Failed to start audio playback:",o),this.consoleOutput+=`Failed to start audio playback: ${o.message||"Unknown error"}
`,new Error(`Failed to start audio playback: ${o.message||"Unknown error"}`)}}stop(){try{this.audioContext&&(this.workletNode&&this.workletNode.port.postMessage({type:"stop"}),this.audioContext.suspend(),this.consoleOutput+=`Audio playback stopped
`)}catch(o){console.error("Failed to stop audio playback:",o),this.consoleOutput+=`Failed to stop audio playback: ${o.message||"Unknown error"}
`}}handleGenFunction(o,t,s,u){const i=new Float32Array(512);if(t===0||t===1){const a=[];for(let e=0;e<u.length;e+=2){const r=u[e]||0,c=Math.floor(u[e+1]||(e===u.length-1?511:0));c>=0&&c<512&&(a.push({position:c,value:r}),this.consoleOutput+=`  Point: val=${r}, pos=${c}
`)}a.sort((e,r)=>e.position-r.position),a.length<2&&(a.length===0?(a.push({position:0,value:0}),a.push({position:511,value:0})):a.push({position:511,value:a[0].value}));for(let e=0;e<a.length-1;e++){const r=a[e],c=a[e+1],l=r.position,m=c.position,d=r.value,h=c.value;for(let f=l;f<=m;f++){const k=m===l?0:(f-l)/(m-l);i[f]=d*(1-k)+h*k}}this.consoleOutput+=`Function table ${o} created with ${a.length} points
`}else{for(let a=0;a<512;a++)i[a]=Math.sin(2*Math.PI*a/512);this.consoleOutput+=`Warning: GEN type ${t} not supported, using sine wave
`}if(s>0){let a=1/0,e=-1/0;for(let c=0;c<512;c++)a=Math.min(a,i[c]),e=Math.max(e,i[c]);let r=1;if(s===1?r=Math.max(Math.abs(a),Math.abs(e)):s===2&&(r=e-a),r!==0)for(let c=0;c<512;c++)s===1?i[c]/=r:s===2&&(i[c]=(i[c]-a)/r)}this.functions.set(o,i)}getConsoleOutput(){return this.consoleOutput}getFunctionTables(){return Array.from(this.functions.entries()).map(([o,t])=>({functionNum:o,data:Array.from(t)}))}}export{xe as A,be as H,we as M,ye as a,Ie as u};
