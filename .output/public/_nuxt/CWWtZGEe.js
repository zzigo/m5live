import{_ as Re,r as i,H as Ne,o as Ie,I as N,J as Ke,K as we,t as c,x as l,L as b,z as S,A as oe,T as le,M as ke,N as Ee,O as be,P as I,Q as K,R as z,y as H,v as d,S as ze}from"./CrTiFUtV.js";import{M as Ze,u as Ye,A as ae,H as je,a as qe}from"./BX48IDwY.js";const We={class:"app-container"},Ge={class:"settings"},Je=["title"],Qe={key:0,class:"icon",viewBox:"0 0 24 24"},Xe={key:1,class:"icon",viewBox:"0 0 24 24"},et={key:0,class:"current-title"},tt={class:"icon",viewBox:"0 0 24 24"},ot={key:0,fill:"currentColor",d:"M8,5.14V19.14L19,12.14L8,5.14Z"},lt={key:1,fill:"currentColor",d:"M18,18H6V6H18V18Z"},at={key:0,class:"content-wrapper"},nt={class:"editor-container"},st={key:0,class:"mini-oscilloscopes"},it={class:"mini-oscilloscope-label"},rt=["src"],ut=["src"],ct={class:"storage-menu-content"},dt={class:"left-panel"},vt={class:"entry-fields"},ft={class:"code-list"},mt=["onClick"],pt={class:"right-panel"},gt={class:"code-actions"},Ct={class:"footer"},yt={key:0,class:"loading"},ht={key:2,class:"error"},Le=`
INS 0 1 ;
OSC P5 P6 B2 F2 P30;
OUT B2 B1;
END;
GEN 0 1 2 0 0 .999 50 .999 205 -.999 306 -.999 461 0 511;
NOT 0 1 .50 125 8.45;
NOT .75 1 .17 250 8.45;
NOT 4.00 2 .50 500 8.46;
TER 8.00 ;
`,wt={__name:"index",setup(kt){const L={debug:(e,t,...o)=>{h&&h.value&&console.debug(`[${e}]`,t,...o)},info:(e,t,...o)=>{console.info(`[${e}]`,t,...o)},warn:(e,t,...o)=>{console.warn(`[${e}]`,t,...o)},error:(e,t,...o)=>{console.error(`[${e}]`,t,...o)}},x=new Ze,{startProcessing:ne,completeProcessing:Z}=Ye(),C=i(null),V=i(null),w=i(null),A=i(!1),O=i(0),_=i(null),Y=i(null),F=i(!0),j=i(!1),B=i(!1),xe=i(0),se=i(!1),D=i(!1),q=i(null),$=i([]),y=Ne({}),R=i(""),h=i(!1),T=i(!1),M=i(!0),m=i([]),ie=i({title:"",year:new Date().getFullYear(),composer:"",comments:"",code:""}),k=i(-1),v=i(null),p=i({...ie.value}),W=i(!1),G=i(.85),J=i(.15),re=i(0),ue=i(0),ce=i(0),Q=()=>{se.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},Ve=async()=>{const e=await $fetch("/api/codes");m.value=e.map(t=>({...t,title:t.title||t.code.split(`
`)[0].substring(0,20)+(t.code.split(`
`)[0].length>20?"...":"")||"Untitled"}))||[]};Ie(async()=>{Q(),window.addEventListener("resize",Q),window.addEventListener("keydown",de),await N(),te(),await Ve()}),Ke(()=>{window.removeEventListener("resize",Q),window.removeEventListener("keydown",de),q.value&&URL.revokeObjectURL(q.value)});const de=e=>{e.altKey&&e.shiftKey&&(e.key==="ArrowLeft"&&m.value.length>0?(e.preventDefault(),ve(-1)):e.key==="ArrowRight"&&m.value.length>0&&(e.preventDefault(),ve(1))),e.ctrlKey&&e.key==="p"&&(e.preventDefault(),te()),(/Mac|iPod|iPhone|iPad/.test(navigator.platform)?e.metaKey&&e.key===".":e.ctrlKey&&e.key===".")&&T.value&&(e.preventDefault(),me()),pe(e)},ve=e=>{var o;if(m.value.length===0)return;let t=k.value+e;t<0&&(t=m.value.length-1),t>=m.value.length&&(t=0),k.value=t,v.value=m.value[t],M.value=!1,U(),B.value&&w.value?w.value.addToEditor(v.value.code||""):(o=C.value)==null||o.addToEditor(v.value.code||""),R.value=v.value.title||"Untitled",setTimeout(()=>{R.value=""},4e3)},fe=()=>{var e;return(e=C.value)==null?void 0:e.clearEditor()},Te=()=>F.value=!F.value,X=()=>B.value=!B.value,Me=async()=>{var n,a,r;const{randomizeScore:e}=qe(),t=((a=(n=C.value)==null?void 0:n.aceEditor())==null?void 0:a.getValue())||Le,o=e(t);M.value=!1,U(),(r=C.value)==null||r.addToEditor(o)},Se=()=>{O.value=0;const e=setInterval(()=>{O.value<90&&(O.value+=Math.random()*15),O.value>90&&(O.value=90)},1200);return()=>clearInterval(e)},ee=()=>{var t,o,n;const e=(o=(t=C.value)==null?void 0:t.aceEditor())==null?void 0:o.getValue();if(!(e!=null&&e.trim())){_.value="Please enter some text to evaluate.";return}A.value=!0,ne(),(n=V.value)==null||n.addTerminalOutput("musicV fortran binaries original render next"),A.value=!1,Z()},me=()=>{var e;if(T.value)try{x.stop(),T.value=!1,A.value=!1,Z()}catch(t){(e=V.value)==null||e.addTerminalOutput(`Error stopping playback: ${t.message}`)}},P=async(e=null)=>{var n,a,r,f;if(T.value){me();return}const t=e??((a=(n=C.value)==null?void 0:n.aceEditor())==null?void 0:a.getValue());if(!t||typeof t!="string"||!t.trim()){_.value="Please enter some text to evaluate.";return}A.value=!0,ne();const o=Se();try{M.value=!1,$.value=[],U(),await N(),x.parseScore(t),(r=V.value)==null||r.addTerminalOutput(x.getConsoleOutput()),await x.initAudio(),await x.play(),T.value=!0;const u=await x.generateSound(10),g=He(u,44100);q.value=URL.createObjectURL(g);const s=x.getFunctionTables();h.value&&L.debug("App",`Found ${s.length} function tables`),$.value=[...s],await N(),M.value=!0}catch(u){(f=V.value)==null||f.addTerminalOutput(`Error: ${u.message}`),T.value=!1}finally{o(),A.value=!1,Z()}};we($,e=>{Object.keys(y).forEach(o=>{const n=y[o];if(n){const a=n.getContext("2d");a&&a.clearRect(0,0,n.width,n.height)}});const t=e.map(o=>o.functionNum);Object.keys(y).forEach(o=>{t.includes(parseInt(o))||delete y[o]}),h.value&&L.debug("App",`Drawing ${e.length} oscilloscopes`),setTimeout(()=>e.forEach(De),0)},{deep:!0});const Ae=()=>{v.value&&P(v.value.code)},pe=e=>{e.altKey&&e.key==="Enter"?(e.preventDefault(),P()):e.ctrlKey&&e.key==="Enter"?(e.preventDefault(),ee()):e.ctrlKey&&e.key==="h"&&(e.preventDefault(),fe())},He=(e,t)=>{const o=e.length*2,n=new ArrayBuffer(44+o),a=new DataView(n),r=(g,s)=>{for(let E=0;E<s.length;E++)a.setUint8(g+E,s.charCodeAt(E))};r(0,"RIFF"),a.setUint32(4,36+o,!0),r(8,"WAVE"),r(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,t,!0),a.setUint32(28,t*2,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),r(36,"data"),a.setUint32(40,o,!0);const f=.1;let u=44;for(let g=0;g<e.length;g++){const s=Math.max(-1,Math.min(1,e[g]*f)),E=s<0?s*32768:s*32767;a.setInt16(u,E,!0),u+=2}return new Blob([n],{type:"audio/wav"})},Oe=e=>{W.value=!0,re.value=e.clientY,ue.value=G.value,ce.value=J.value,document.addEventListener("mousemove",ge),document.addEventListener("mouseup",Ce),document.body.style.userSelect="none"},ge=e=>{if(!W.value)return;const t=document.querySelector(".editor-container");if(!t)return;const o=t.clientHeight,a=(e.clientY-re.value)/o;let r=ue.value+a,f=ce.value-a;const u=.1;r<u?(r=u,f=1-u):f<u&&(f=u,r=1-u),G.value=r,J.value=f},Ce=()=>{W.value=!1,document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",Ce),document.body.style.userSelect="",N(()=>{var e,t;(e=C.value)==null||e.resize(),(t=V.value)==null||t.resize()})},te=()=>{var e;(e=V.value)==null||e.clearTerminal()},Fe=()=>{m.value.push({...p.value}),p.value={title:"",year:new Date().getFullYear(),composer:"",comments:"",code:""},k.value=m.value.length-1,v.value=m.value[k.value],w.value&&w.value.addToEditor("")},$e=async e=>{var t,o;if(e>=0&&v.value){const n=((o=(t=w.value)==null?void 0:t.aceEditor())==null?void 0:o.getValue())||"";m.value[e]={...p.value,code:n},await ye()}},Pe=async e=>{e>=0&&confirm("Delete this code?")&&(m.value.splice(e,1),k.value=-1,v.value=null,p.value={...ie.value},w.value&&w.value.addToEditor(""),await ye())},ye=async()=>{await $fetch("/api/codes",{method:"POST",body:m.value})},Ue=e=>{var o;k.value=e,v.value=m.value[e],p.value={...v.value};const t=(o=w.value)==null?void 0:o.aceEditor();t&&t.setValue(v.value.code||"",-1)},_e=e=>{v.value&&(v.value.code=e,p.value.code=e)},Be=()=>{var e;v.value&&((e=C.value)==null||e.addToEditor(v.value.code||""),X(),U())},De=e=>{if(!e||!e.functionNum||!e.data||e.data.length===0){h.value&&L.warn("Oscilloscope",`Invalid function table data for F${(e==null?void 0:e.functionNum)||"unknown"}`);return}const t=y[e.functionNum];if(!t){h.value&&L.warn("Oscilloscope",`Canvas not found for function table F${e.functionNum}`);return}const o=t.getContext("2d");if(!o){h.value&&L.warn("Oscilloscope",`Could not get 2D context for canvas F${e.functionNum}`);return}h.value&&L.debug("Oscilloscope",`Drawing function table F${e.functionNum} with ${e.data.length} points`);const n=t.width,a=t.height,r=e.data;o.clearRect(0,0,n,a),o.fillStyle="#1a1a1a",o.fillRect(0,0,n,a),o.strokeStyle="#333333",o.lineWidth=.5;for(let s=0;s<=n;s+=n/4)o.beginPath(),o.moveTo(s,0),o.lineTo(s,a),o.stroke();for(let s=0;s<=a;s+=a/2)o.beginPath(),o.moveTo(0,s),o.lineTo(n,s),o.stroke();o.strokeStyle="#555555",o.beginPath(),o.moveTo(0,a/2),o.lineTo(n,a/2),o.stroke();let f=1/0,u=-1/0;for(let s=0;s<r.length;s++)f=Math.min(f,r[s]),u=Math.max(u,r[s]);f===u&&(f-=.5,u+=.5),o.strokeStyle="#00ff00",o.lineWidth=1.5,o.beginPath();const g=r.length;try{for(let s=0;s<g;s++){const E=s/(g-1)*n,he=(1-(r[s]-f)/(u-f))*a;s===0?o.moveTo(E,he):o.lineTo(E,he)}o.stroke(),o.fillStyle="#00ff00",o.font="9px monospace",o.fillText(`${u.toFixed(2)}`,2,8),o.fillText(`${f.toFixed(2)}`,2,a-2),o.fillText(`${g}p`,n-25,8)}catch(s){h.value&&L.error("Oscilloscope",`Error drawing oscilloscope for F${e.functionNum}:`,s)}},U=()=>{M.value=!1,Object.keys(y).forEach(e=>{const t=y[e];if(t){const o=t.getContext("2d");o&&(o.clearRect(0,0,t.width,t.height),o.fillStyle="#1a1a1a",o.fillRect(0,0,t.width,t.height))}}),Object.keys(y).forEach(e=>{delete y[e]}),$.value=[],h.value&&L.debug("App","Cleared all oscilloscopes")};return we(()=>{var e,t;return(t=(e=C.value)==null?void 0:e.aceEditor())==null?void 0:t.getValue()},()=>{M.value=!1,U()},{deep:!0}),(e,t)=>(d(),c("div",We,[l("div",Ge,[l("button",{onClick:Te,class:"icon-button",title:F.value?"Hide Code":"Show Code"},[F.value?(d(),c("svg",Qe,t[12]||(t[12]=[l("path",{fill:"currentColor",d:"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"},null,-1)]))):(d(),c("svg",Xe,t[13]||(t[13]=[l("path",{fill:"currentColor",d:"M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z"},null,-1)]))),S(le,{name:"title-fade"},{default:oe(()=>[R.value?(d(),c("span",et,H(R.value),1)):b("",!0)]),_:1})],8,Je),l("button",{onClick:ee,class:"icon-button",title:"Evaluate Binary (Ctrl+Enter)"},t[14]||(t[14]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M8,5.14V19.14L19,12.14L8,5.14Z"})],-1),l("span",{class:"f-subscript"},"F",-1)])),l("button",{onClick:P,class:"icon-button",title:"Evaluate TS (Alt+Enter)"},[(d(),c("svg",tt,[T.value?(d(),c("path",lt)):(d(),c("path",ot))])),t[15]||(t[15]=l("span",{class:"ts-subscript"},"TS",-1))]),l("button",{onClick:fe,class:"icon-button",title:"Clear Editor (Ctrl+H)"},t[16]||(t[16]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,21V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})],-1)])),l("button",{onClick:Me,class:"icon-button",title:"Randomize Score"},t[17]||(t[17]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M14.83,13.41L13.42,14.82L16.55,17.95L14.5,20H20V14.5L17.96,16.54L14.83,13.41M14.5,4L16.54,6.04L4,18.59L5.41,20L17.96,7.46L20,9.5V4M10.59,9.17L5.41,4L4,5.41L9.17,10.58L10.59,9.17Z"})],-1)])),l("button",{onClick:t[0]||(t[0]=o=>j.value=!0),class:"icon-button",title:"Help"},t[18]||(t[18]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"})],-1)])),l("button",{onClick:X,class:"icon-button",title:"Storage Menu (Ctrl+M)"},t[19]||(t[19]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)]))]),F.value?(d(),c("div",at,[l("div",nt,[l("div",{class:"score-editor",style:ke({flex:G.value})},[S(ae,{ref_key:"scoreEditorRef",ref:C,mode:"editor",value:Le,onEvaluate:ee,onEvaluateTS:P,onKeydown:pe},null,512),M.value?(d(),c("div",st,[(d(!0),c(Ee,null,be($.value,(o,n)=>(d(),c("div",{key:`table-${o.functionNum}-${n}`,class:"mini-oscilloscope"},[l("div",it,"F"+H(o.functionNum),1),l("canvas",{ref_for:!0,ref:a=>{a&&(y[o.functionNum]=a)},width:"80",height:"50",class:"mini-oscilloscope-canvas"},null,512)]))),128))])):b("",!0)],4),l("div",{class:"divider",onMousedown:Oe},null,32),l("div",{class:"console-editor",style:ke({flex:J.value})},[l("div",{class:"console-header"},[l("button",{class:"clear-btn",onClick:te,title:"Clear console (Ctrl+P)"},"ðŸ—‘ï¸")]),S(ae,{ref_key:"consoleEditorRef",ref:V,mode:"terminal"},null,512)],4)])])):b("",!0),S(le,{"enter-active-class":"fadeIn","leave-active-class":"fadeOut",duration:3e3,mode:"out-in"},{default:oe(()=>[Y.value?(d(),c("div",{class:"plot-display",key:xe.value},[l("img",{src:`data:image/png;base64,${Y.value}`,alt:"Plot",onClick:t[1]||(t[1]=o=>D.value=!0),class:"plot-image"},null,8,rt)])):b("",!0)]),_:1}),S(le,{"enter-active-class":"fadeIn","leave-active-class":"fadeOut",duration:300},{default:oe(()=>[D.value?(d(),c("div",{key:0,class:"lightbox",onClick:t[4]||(t[4]=o=>D.value=!1)},[l("button",{class:"close-button",onClick:t[2]||(t[2]=I(o=>D.value=!1,["stop"]))},t[20]||(t[20]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)])),l("img",{src:`data:image/png;base64,${Y.value}`,alt:"Plot",class:"lightbox-image",onClick:t[3]||(t[3]=I(()=>{},["stop"]))},null,8,ut)])):b("",!0)]),_:1}),B.value?(d(),c("div",{key:1,class:"storage-menu",onClick:I(X,["self"])},[l("div",ct,[l("div",dt,[l("div",vt,[l("form",{onSubmit:I(Fe,["prevent"])},[K(l("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>p.value.title=o),placeholder:"Title",required:""},null,512),[[z,p.value.title]]),K(l("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=o=>p.value.year=o),placeholder:"Year",required:""},null,512),[[z,p.value.year,void 0,{number:!0}]]),K(l("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>p.value.composer=o),placeholder:"Composer",required:""},null,512),[[z,p.value.composer]]),K(l("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>p.value.comments=o),placeholder:"Comments",rows:"3",required:""},null,512),[[z,p.value.comments]]),t[21]||(t[21]=l("button",{type:"submit"},"[ Add ]",-1))],32)]),l("div",ft,[(d(!0),c(Ee,null,be(m.value,(o,n)=>(d(),c("div",{key:n,class:ze({selected:k.value===n}),onClick:a=>Ue(n)},H(o.composer)+" - "+H(o.year)+" - "+H(o.title||"Untitled"),11,mt))),128))])]),l("div",pt,[S(ae,{ref_key:"codeEditorRef",ref:w,mode:"editor",value:v.value?v.value.code:"",onInput:_e},null,8,["value"]),l("div",gt,[l("button",{onClick:Ae},"[ Play TS ]"),l("button",{onClick:Be},"[ To Editor ]"),l("button",{onClick:t[9]||(t[9]=o=>$e(k.value))},"[ Update ]"),l("button",{onClick:t[10]||(t[10]=o=>Pe(k.value))},"[ Delete ]")])])])])):b("",!0),l("div",Ct,[A.value?(d(),c("div",yt,"Processing...")):b("",!0),se.value?(d(),c("button",{key:1,onClick:P,class:"mobile-evaluate-btn",title:"Alt+Enter"},"Evaluate TS")):b("",!0)]),_.value?(d(),c("div",ht,H(_.value),1)):b("",!0),S(je,{modelValue:j.value,"onUpdate:modelValue":t[11]||(t[11]=o=>j.value=o)},null,8,["modelValue"])]))}},xt=Re(wt,[["__scopeId","data-v-1d25b060"]]);export{xt as default};
