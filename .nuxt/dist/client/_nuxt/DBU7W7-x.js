import{_ as Ye,r as s,I as je,o as Ge,J as le,K as Je,H as Qe,t as f,x as l,L as E,z as V,A as ae,T as ne,M as Ve,N as xe,O as Me,P as _,Q as I,R as K,y as x,v as m,U as Xe}from"./DdQN4F8u.js";import{M as et,u as tt,A as se,H as ot,a as lt}from"./DSEoa7WU.js";import"./Dv6OuOwg.js";const at={class:"app-container"},nt={class:"settings"},st=["title"],it={key:0,class:"icon",viewBox:"0 0 24 24"},rt={key:1,class:"icon",viewBox:"0 0 24 24"},ut={key:0,class:"current-title"},dt={key:0,class:"content-wrapper"},ct={class:"editor-container"},vt={class:"mini-oscilloscopes"},ft={class:"mini-oscilloscope-label"},mt=["src"],pt=["src"],Ct={class:"storage-menu-content"},gt={class:"left-panel"},yt={class:"entry-fields"},ht={class:"code-list"},wt=["onClick"],bt={class:"right-panel"},Lt={class:"code-actions"},Tt={class:"footer"},Et={key:0,class:"loading"},kt={key:2,class:"error"},Se=`
INS 0 1 ;
OSC P5 P6 B2 F2 P30;
OUT B2 B1;
END;
GEN 0 1 2 0 0 .999 50 .999 205 -.999 306 -.999 461 0 511;
NOT 0 1 .50 125 8.45;
NOT .75 1 .17 250 8.45;
NOT 4.00 1 .50 500 8.46; // Fixed instrument to 1
TER 8.00 ;
`,Vt={__name:"indextorefact",setup(xt){const M=new et,{startProcessing:ie,completeProcessing:re}=tt(),T=s(null),h=s(null),w=s(null),$=s(!1),S=s(0),q=s(null),z=s(null),A=s(!0),Z=s(!1),U=s(!1),Oe=s(0),ue=s(!1),F=s(!1),k=s(null),P=s([]),R=je({}),B=s(""),v=s([]),de=s({title:"",year:new Date().getFullYear(),composer:"",comments:"",code:""}),b=s(-1),u=s(null),p=s({...de.value}),W=s(!1),Y=s(.85),j=s(.15),ce=s(0),ve=s(0),fe=s(0),G=()=>{ue.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},$e=async()=>{const o=await $fetch("/api/codes");v.value=o.map(e=>({...e,title:e.title||e.code.split(`
`)[0].substring(0,20)+(e.code.split(`
`)[0].length>20?"...":"")||"Untitled"}))||[]};Ge(async()=>{G(),window.addEventListener("resize",G),window.addEventListener("keydown",me),await le(),be(),await $e()}),Je(()=>{window.removeEventListener("resize",G),window.removeEventListener("keydown",me),k.value&&URL.revokeObjectURL(k.value)});const me=o=>{o.altKey&&o.shiftKey&&(o.key==="ArrowLeft"&&v.value.length>0?(o.preventDefault(),pe(-1)):o.key==="ArrowRight"&&v.value.length>0&&(o.preventDefault(),pe(1))),ye(o)},pe=o=>{var t;if(v.value.length===0)return;let e=b.value+o;e<0&&(e=v.value.length-1),e>=v.value.length&&(e=0),b.value=e,u.value=v.value[e],U.value&&w.value?w.value.addToEditor(u.value.code||""):(t=T.value)==null||t.addToEditor(u.value.code||""),B.value=u.value.title||"Untitled",setTimeout(()=>{B.value=""},4e3)},Ce=()=>{var o;return(o=T.value)==null?void 0:o.clearEditor()},Ae=()=>A.value=!A.value,J=()=>U.value=!U.value,He=async()=>{var t;const{getRandomPrompt:o}=lt(),e=await o();(t=T.value)==null||t.addToEditor(e)},ge=()=>{S.value=0;const o=setInterval(()=>{S.value<90&&(S.value+=Math.random()*15),S.value>90&&(S.value=90)},1200);return()=>clearInterval(o)},Q=()=>{var t,i;const o=(i=(t=T.value)==null?void 0:t.aceEditor())==null?void 0:i.getValue();if(!(o!=null&&o.trim())){q.value="Please enter some text to evaluate.";return}$.value=!0,ie();const e=ge();setTimeout(()=>{var a;(a=h.value)==null||a.addTerminalOutput("Binary evaluation not implemented yet."),e(),$.value=!1,re()},1e3)},H=async(o=null)=>{var i,a,d,c,r,g,n,y,X;let e=o??((a=(i=T.value)==null?void 0:i.aceEditor())==null?void 0:a.getValue());(!e||typeof e!="string"||!e.trim())&&(e=Se),$.value=!0,ie();const t=ge();try{(d=h.value)==null||d.addTerminalOutput(""),P.value=[],Object.keys(R).forEach(L=>delete R[L]),await le();const O=e.split(`
`);let Te=[],ee=[],Ee=!1;for(const L of O){if(L.trim().startsWith("COMMENT: CONVT")||L.trim().startsWith("CONVT")){Ee=!0,(c=h.value)==null||c.addTerminalOutput("Detected CONVT directive - applying frequency conversion","info");continue}if(L.trim().startsWith("GEN"))Te=L.split(/\s+/).map(C=>parseFloat(C)||C);else if(L.trim().startsWith("NOT")){const C=L.split(/\s+/).map(oe=>parseFloat(oe)||oe),te=C[1],N=C[2];let D=C[5];if(Ee&&te===1&&N>=1&&N<=6){const Ze=511/(Te[4]||512),We=D;D*=Ze,(r=h.value)==null||r.addTerminalOutput(`CONVT: Scaled freq ${We} to ${D.toFixed(2)} for ins ${N} at time ${te}`,"info")}ee.push(`NOT ${te} ${N} ${C[3]} ${C[4]} ${D}${C[6]?` ${C[6]}`:""}${C[7]?` ${C[7]}`:""}${C[8]?` ${C[8]}`:""}`)}else ee.push(L)}e=ee.join(`
`),M.parseScore(e),(g=h.value)==null||g.addTerminalOutput(M.getConsoleOutput()),await M.initAudio(),await M.play();const qe=await M.generateSound(10),ze=Fe(qe,44100);k.value&&URL.revokeObjectURL(k.value),k.value=URL.createObjectURL(ze),(n=h.value)==null||n.addTerminalOutput(`Audio generated: ${k.value}`),P.value=M.getFunctionTables();const ke=`musicv-output-${new Date().toISOString().replace(/[:.]/g,"-")}.wav`;(y=h.value)==null||y.addTerminalOutput(`<a href="${k.value}" download="${ke}" style="color:#ffb000;">Download ${ke}</a>`,"html")}catch(O){(X=h.value)==null||X.addTerminalOutput(`Error: ${O.message}`)}finally{t(),$.value=!1,re()}};Qe(P,o=>{setTimeout(()=>o.forEach(Ke),0)},{deep:!0});const Ue=()=>{u.value&&H(u.value.code)},ye=o=>{o.altKey&&o.key==="Enter"?(o.preventDefault(),H()):o.ctrlKey&&o.key==="Enter"?(o.preventDefault(),Q()):o.ctrlKey&&o.key==="h"&&(o.preventDefault(),Ce())},Fe=(o,e)=>{const t=o.length*2,i=new ArrayBuffer(44+t),a=new DataView(i),d=(g,n)=>{for(let y=0;y<n.length;y++)a.setUint8(g+y,n.charCodeAt(y))};d(0,"RIFF"),a.setUint32(4,36+t,!0),d(8,"WAVE"),d(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,e,!0),a.setUint32(28,e*2,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),d(36,"data"),a.setUint32(40,t,!0);const c=.1;let r=44;for(let g=0;g<o.length;g++){const n=Math.max(-1,Math.min(1,o[g]*c)),y=n<0?n*32768:n*32767;a.setInt16(r,y,!0),r+=2}return new Blob([i],{type:"audio/wav"})},Pe=o=>{W.value=!0,ce.value=o.clientY,ve.value=Y.value,fe.value=j.value,document.addEventListener("mousemove",he),document.addEventListener("mouseup",we),document.body.style.userSelect="none"},he=o=>{if(!W.value)return;const e=document.querySelector(".editor-container");if(!e)return;const t=e.clientHeight,a=(o.clientY-ce.value)/t;let d=ve.value+a,c=fe.value-a;const r=.1;d<r?(d=r,c=1-r):c<r&&(c=r,d=1-r),Y.value=d,j.value=c},we=()=>{W.value=!1,document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",we),document.body.style.userSelect="",le(()=>{var o,e;(o=T.value)==null||o.resize(),(e=h.value)==null||e.resize()})},be=()=>{var o;(o=h.value)==null||o.addTerminalOutput(`MUSIC V SCORE PROCESSING
=======================
Ready to evaluate.`)},Re=()=>{v.value.push({...p.value}),p.value={title:"",year:new Date().getFullYear(),composer:"",comments:"",code:""},b.value=v.value.length-1,u.value=v.value[b.value],w.value&&w.value.addToEditor("")},Be=async o=>{var e,t;if(o>=0&&u.value){const i=((t=(e=w.value)==null?void 0:e.aceEditor())==null?void 0:t.getValue())||"";v.value[o]={...p.value,code:i},await Le()}},Ne=async o=>{o>=0&&confirm("Delete this code?")&&(v.value.splice(o,1),b.value=-1,u.value=null,p.value={...de.value},w.value&&w.value.addToEditor(""),await Le())},Le=async()=>{await $fetch("/api/codes",{method:"POST",body:v.value})},De=o=>{var t;b.value=o,u.value=v.value[o],p.value={...u.value};const e=(t=w.value)==null?void 0:t.aceEditor();e&&e.setValue(u.value.code||"",-1)},_e=o=>{u.value&&(u.value.code=o,p.value.code=o)},Ie=()=>{var o;u.value&&((o=T.value)==null||o.addToEditor(u.value.code||""),J())},Ke=o=>{const e=R[o.functionNum];if(!e)return;const t=e.getContext("2d");if(!t)return;const i=e.width,a=e.height,d=o.data;t.clearRect(0,0,i,a),t.fillStyle="#1a1a1a",t.fillRect(0,0,i,a),t.strokeStyle="#333333",t.lineWidth=.5;for(let n=0;n<=i;n+=i/4)t.beginPath(),t.moveTo(n,0),t.lineTo(n,a),t.stroke();for(let n=0;n<=a;n+=a/2)t.beginPath(),t.moveTo(0,n),t.lineTo(i,n),t.stroke();t.strokeStyle="#555555",t.beginPath(),t.moveTo(0,a/2),t.lineTo(i,a/2),t.stroke();let c=1/0,r=-1/0;for(let n=0;n<d.length;n++)c=Math.min(c,d[n]),r=Math.max(r,d[n]);c===r&&(c-=.5,r+=.5),t.strokeStyle="#00ff00",t.lineWidth=1.5,t.beginPath();const g=d.length;for(let n=0;n<g;n++){const y=n/(g-1)*i,O=(1-(d[n]-c)/(r-c))*a;n===0?t.moveTo(y,O):t.lineTo(y,O)}t.stroke(),t.fillStyle="#00ff00",t.font="9px monospace",t.fillText(`${r.toFixed(2)}`,2,8),t.fillText(`${c.toFixed(2)}`,2,a-2),t.fillText(`${g}p`,i-25,8)};return(o,e)=>(m(),f("div",at,[l("div",nt,[l("button",{onClick:Ae,class:"icon-button",title:A.value?"Hide Code":"Show Code"},[A.value?(m(),f("svg",it,e[12]||(e[12]=[l("path",{fill:"currentColor",d:"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"},null,-1)]))):(m(),f("svg",rt,e[13]||(e[13]=[l("path",{fill:"currentColor",d:"M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z"},null,-1)]))),V(ne,{name:"title-fade"},{default:ae(()=>[B.value?(m(),f("span",ut,x(B.value),1)):E("",!0)]),_:1})],8,st),l("button",{onClick:Q,class:"icon-button",title:"Evaluate Binary (Ctrl+Enter)"},e[14]||(e[14]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M8,5.14V19.14L19,12.14L8,5.14Z"})],-1)])),l("button",{onClick:H,class:"icon-button",title:"Evaluate TS (Alt+Enter)"},e[15]||(e[15]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M8,5.14V19.14L19,12.14L8,5.14Z"})],-1),l("span",{class:"ts-subscript"},"TS",-1)])),l("button",{onClick:Ce,class:"icon-button",title:"Clear Editor (Ctrl+H)"},e[16]||(e[16]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,21V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})],-1)])),l("button",{onClick:He,class:"icon-button",title:"Random Prompt"},e[17]||(e[17]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M14.83,13.41L13.42,14.82L16.55,17.95L14.5,20H20V14.5L17.96,16.54L14.83,13.41M14.5,4L16.54,6.04L4,18.59L5.41,20L17.96,7.46L20,9.5V4M10.59,9.17L5.41,4L4,5.41L9.17,10.58L10.59,9.17Z"})],-1)])),l("button",{onClick:e[0]||(e[0]=t=>Z.value=!0),class:"icon-button",title:"Help"},e[18]||(e[18]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"})],-1)])),l("button",{onClick:J,class:"icon-button",title:"Storage Menu (Ctrl+M)"},e[19]||(e[19]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)]))]),A.value?(m(),f("div",dt,[l("div",ct,[l("div",{class:"score-editor",style:Ve({flex:Y.value})},[V(se,{ref_key:"scoreEditorRef",ref:T,mode:"editor",value:Se,onEvaluate:Q,onEvaluateTS:H,onKeydown:ye},null,512),l("div",vt,[(m(!0),f(xe,null,Me(P.value,(t,i)=>(m(),f("div",{key:i,class:"mini-oscilloscope"},[l("div",ft,"F"+x(t.functionNum),1),l("canvas",{ref_for:!0,ref:a=>{a&&(R[t.functionNum]=a)},width:"80",height:"50",class:"mini-oscilloscope-canvas"},null,512)]))),128))])],4),l("div",{class:"divider",onMousedown:Pe},null,32),l("div",{class:"console-editor",style:Ve({flex:j.value})},[l("div",{class:"console-header"},[l("button",{class:"clear-btn",onClick:be,title:"Clear console"},"🗑️")]),V(se,{ref_key:"consoleEditorRef",ref:h,mode:"terminal"},null,512)],4)])])):E("",!0),V(ne,{"enter-active-class":"fadeIn","leave-active-class":"fadeOut",duration:3e3,mode:"out-in"},{default:ae(()=>[z.value?(m(),f("div",{class:"plot-display",key:Oe.value},[l("img",{src:`data:image/png;base64,${z.value}`,alt:"Plot",onClick:e[1]||(e[1]=t=>F.value=!0),class:"plot-image"},null,8,mt)])):E("",!0)]),_:1}),V(ne,{"enter-active-class":"fadeIn","leave-active-class":"fadeOut",duration:300},{default:ae(()=>[F.value?(m(),f("div",{key:0,class:"lightbox",onClick:e[4]||(e[4]=t=>F.value=!1)},[l("button",{class:"close-button",onClick:e[2]||(e[2]=_(t=>F.value=!1,["stop"]))},e[20]||(e[20]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)])),l("img",{src:`data:image/png;base64,${z.value}`,alt:"Plot",class:"lightbox-image",onClick:e[3]||(e[3]=_(()=>{},["stop"]))},null,8,pt)])):E("",!0)]),_:1}),U.value?(m(),f("div",{key:1,class:"storage-menu",onClick:_(J,["self"])},[l("div",Ct,[l("div",gt,[l("div",yt,[l("form",{onSubmit:_(Re,["prevent"])},[I(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>p.value.title=t),placeholder:"Title",required:""},null,512),[[K,p.value.title]]),I(l("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=t=>p.value.year=t),placeholder:"Year",required:""},null,512),[[K,p.value.year,void 0,{number:!0}]]),I(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>p.value.composer=t),placeholder:"Composer",required:""},null,512),[[K,p.value.composer]]),I(l("textarea",{"onUpdate:modelValue":e[8]||(e[8]=t=>p.value.comments=t),placeholder:"Comments",rows:"3",required:""},null,512),[[K,p.value.comments]]),e[21]||(e[21]=l("button",{type:"submit"},"[ Add ]",-1))],32)]),l("div",ht,[(m(!0),f(xe,null,Me(v.value,(t,i)=>(m(),f("div",{key:i,class:Xe({selected:b.value===i}),onClick:a=>De(i)},x(t.composer)+" - "+x(t.year)+" - "+x(t.title||"Untitled"),11,wt))),128))])]),l("div",bt,[V(se,{ref_key:"codeEditorRef",ref:w,mode:"editor",value:u.value?u.value.code:"",onInput:_e},null,8,["value"]),l("div",Lt,[l("button",{onClick:Ue},"[ Play TS ]"),l("button",{onClick:Ie},"[ To Editor ]"),l("button",{onClick:e[9]||(e[9]=t=>Be(b.value))},"[ Update ]"),l("button",{onClick:e[10]||(e[10]=t=>Ne(b.value))},"[ Delete ]")])])])])):E("",!0),l("div",Tt,[$.value?(m(),f("div",Et,"Processing... "+x(Math.round(S.value))+"%",1)):E("",!0),ue.value?(m(),f("button",{key:1,onClick:H,class:"mobile-evaluate-btn",title:"Alt+Enter"},"Evaluate TS")):E("",!0)]),q.value?(m(),f("div",kt,x(q.value),1)):E("",!0),V(ot,{modelValue:Z.value,"onUpdate:modelValue":e[11]||(e[11]=t=>Z.value=t)},null,8,["modelValue"])]))}},Ht=Ye(Vt,[["__scopeId","data-v-fab1b029"]]);export{Ht as default};
