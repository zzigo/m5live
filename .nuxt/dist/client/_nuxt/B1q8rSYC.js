import{_ as _e,r as i,H as Be,o as De,I as X,J as Re,K as Ne,t as d,x as l,L,z as M,A as ee,T as te,M as he,N as we,O as ke,P as D,Q as R,R as N,y as A,v,S as Ie}from"./B0TynPC5.js";import{M as Ke,u as Ze,A as oe,H as ze,a as Ye}from"./D_AgpLSG.js";const je={class:"app-container"},qe={class:"settings"},We=["title"],Ge={key:0,class:"icon",viewBox:"0 0 24 24"},Je={key:1,class:"icon",viewBox:"0 0 24 24"},Qe={key:0,class:"current-title"},Xe={class:"icon",viewBox:"0 0 24 24"},et={key:0,fill:"currentColor",d:"M8,5.14V19.14L19,12.14L8,5.14Z"},tt={key:1,fill:"currentColor",d:"M18,18H6V6H18V18Z"},ot={key:0,class:"content-wrapper"},lt={class:"editor-container"},at={class:"mini-oscilloscopes"},nt={class:"mini-oscilloscope-label"},st=["src"],it=["src"],rt={class:"storage-menu-content"},ut={class:"left-panel"},ct={class:"entry-fields"},dt={class:"code-list"},vt=["onClick"],ft={class:"right-panel"},pt={class:"code-actions"},mt={class:"footer"},gt={key:0,class:"loading"},Ct={key:2,class:"error"},yt=`
INS 0 1 ;
OSC P5 P6 B2 F2 P30;
OUT B2 B1;
END;
GEN 0 1 2 0 0 .999 50 .999 205 -.999 306 -.999 461 0 511;
NOT 0 1 .50 125 8.45;
NOT .75 1 .17 250 8.45;
NOT 4.00 2 .50 500 8.46;
TER 8.00 ;
`,ht={__name:"index",setup(wt){const b={debug:(e,t,...o)=>{y&&y.value&&console.debug(`[${e}]`,t,...o)},info:(e,t,...o)=>{console.info(`[${e}]`,t,...o)},warn:(e,t,...o)=>{console.warn(`[${e}]`,t,...o)},error:(e,t,...o)=>{console.error(`[${e}]`,t,...o)}},x=new Ke,{startProcessing:le,completeProcessing:I}=Ze(),E=i(null),T=i(null),h=i(null),S=i(!1),H=i(0),O=i(null),K=i(null),P=i(!0),Z=i(!1),$=i(!1),be=i(0),ae=i(!1),U=i(!1),z=i(null),_=i([]),C=Be({}),B=i(""),y=i(!1),V=i(!1),p=i([]),ne=i({title:"",year:new Date().getFullYear(),composer:"",comments:"",code:""}),w=i(-1),u=i(null),m=i({...ne.value}),Y=i(!1),j=i(.85),q=i(.15),se=i(0),ie=i(0),re=i(0),W=()=>{ae.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},Ee=async()=>{const e=await $fetch("/api/codes");p.value=e.map(t=>({...t,title:t.title||t.code.split(`
`)[0].substring(0,20)+(t.code.split(`
`)[0].length>20?"...":"")||"Untitled"}))||[]};De(async()=>{W(),window.addEventListener("resize",W),window.addEventListener("keydown",ue),await X(),Q(),await Ee()}),Re(()=>{window.removeEventListener("resize",W),window.removeEventListener("keydown",ue),z.value&&URL.revokeObjectURL(z.value)});const ue=e=>{e.altKey&&e.shiftKey&&(e.key==="ArrowLeft"&&p.value.length>0?(e.preventDefault(),ce(-1)):e.key==="ArrowRight"&&p.value.length>0&&(e.preventDefault(),ce(1))),e.ctrlKey&&e.key==="p"&&(e.preventDefault(),Q()),(/Mac|iPod|iPhone|iPad/.test(navigator.platform)?e.metaKey&&e.key===".":e.ctrlKey&&e.key===".")&&V.value&&(e.preventDefault(),ve()),fe(e)},ce=e=>{var o;if(p.value.length===0)return;let t=w.value+e;t<0&&(t=p.value.length-1),t>=p.value.length&&(t=0),w.value=t,u.value=p.value[t],$.value&&h.value?h.value.addToEditor(u.value.code||""):(o=E.value)==null||o.addToEditor(u.value.code||""),B.value=u.value.title||"Untitled",setTimeout(()=>{B.value=""},4e3)},de=()=>{var e;return(e=E.value)==null?void 0:e.clearEditor()},Le=()=>P.value=!P.value,G=()=>$.value=!$.value,xe=async()=>{var o;const{getRandomPrompt:e}=Ye(),t=await e();(o=E.value)==null||o.addToEditor(t)},Te=()=>{H.value=0;const e=setInterval(()=>{H.value<90&&(H.value+=Math.random()*15),H.value>90&&(H.value=90)},1200);return()=>clearInterval(e)},J=()=>{var t,o,s;const e=(o=(t=E.value)==null?void 0:t.aceEditor())==null?void 0:o.getValue();if(!(e!=null&&e.trim())){O.value="Please enter some text to evaluate.";return}S.value=!0,le(),(s=T.value)==null||s.addTerminalOutput("musicV fortran binaries original render next"),S.value=!1,I()},ve=()=>{var e;if(V.value)try{x.stop(),V.value=!1,S.value=!1,I()}catch(t){(e=T.value)==null||e.addTerminalOutput(`Error stopping playback: ${t.message}`)}},F=async(e=null)=>{var s,a,c,f;if(V.value){ve();return}const t=e??((a=(s=E.value)==null?void 0:s.aceEditor())==null?void 0:a.getValue());if(!t||typeof t!="string"||!t.trim()){O.value="Please enter some text to evaluate.";return}S.value=!0,le();const o=Te();try{Ce(),await X(),x.parseScore(t),(c=T.value)==null||c.addTerminalOutput(x.getConsoleOutput()),await x.initAudio(),await x.play(),V.value=!0;const r=await x.generateSound(10),g=Me(r,44100);z.value=URL.createObjectURL(g);const n=x.getFunctionTables();y.value&&b.debug("App",`Found ${n.length} function tables`),_.value=n}catch(r){(f=T.value)==null||f.addTerminalOutput(`Error: ${r.message}`),V.value=!1}finally{o(),S.value=!1,I()}};Ne(_,e=>{Object.keys(C).forEach(o=>{const s=C[o];if(s){const a=s.getContext("2d");a&&a.clearRect(0,0,s.width,s.height)}});const t=e.map(o=>o.functionNum);Object.keys(C).forEach(o=>{t.includes(parseInt(o))||delete C[o]}),y.value&&b.debug("App",`Drawing ${e.length} oscilloscopes`),setTimeout(()=>e.forEach(Ue),0)},{deep:!0});const Ve=()=>{u.value&&F(u.value.code)},fe=e=>{e.altKey&&e.key==="Enter"?(e.preventDefault(),F()):e.ctrlKey&&e.key==="Enter"?(e.preventDefault(),J()):e.ctrlKey&&e.key==="h"&&(e.preventDefault(),de())},Me=(e,t)=>{const o=e.length*2,s=new ArrayBuffer(44+o),a=new DataView(s),c=(g,n)=>{for(let k=0;k<n.length;k++)a.setUint8(g+k,n.charCodeAt(k))};c(0,"RIFF"),a.setUint32(4,36+o,!0),c(8,"WAVE"),c(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,t,!0),a.setUint32(28,t*2,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),c(36,"data"),a.setUint32(40,o,!0);const f=.1;let r=44;for(let g=0;g<e.length;g++){const n=Math.max(-1,Math.min(1,e[g]*f)),k=n<0?n*32768:n*32767;a.setInt16(r,k,!0),r+=2}return new Blob([s],{type:"audio/wav"})},Se=e=>{Y.value=!0,se.value=e.clientY,ie.value=j.value,re.value=q.value,document.addEventListener("mousemove",pe),document.addEventListener("mouseup",me),document.body.style.userSelect="none"},pe=e=>{if(!Y.value)return;const t=document.querySelector(".editor-container");if(!t)return;const o=t.clientHeight,a=(e.clientY-se.value)/o;let c=ie.value+a,f=re.value-a;const r=.1;c<r?(c=r,f=1-r):f<r&&(f=r,c=1-r),j.value=c,q.value=f},me=()=>{Y.value=!1,document.removeEventListener("mousemove",pe),document.removeEventListener("mouseup",me),document.body.style.userSelect="",X(()=>{var e,t;(e=E.value)==null||e.resize(),(t=T.value)==null||t.resize()})},Q=()=>{var e;(e=T.value)==null||e.clearTerminal()},Ae=()=>{p.value.push({...m.value}),m.value={title:"",year:new Date().getFullYear(),composer:"",comments:"",code:""},w.value=p.value.length-1,u.value=p.value[w.value],h.value&&h.value.addToEditor("")},He=async e=>{var t,o;if(e>=0&&u.value){const s=((o=(t=h.value)==null?void 0:t.aceEditor())==null?void 0:o.getValue())||"";p.value[e]={...m.value,code:s},await ge()}},Pe=async e=>{e>=0&&confirm("Delete this code?")&&(p.value.splice(e,1),w.value=-1,u.value=null,m.value={...ne.value},h.value&&h.value.addToEditor(""),await ge())},ge=async()=>{await $fetch("/api/codes",{method:"POST",body:p.value})},Fe=e=>{var o;w.value=e,u.value=p.value[e],m.value={...u.value};const t=(o=h.value)==null?void 0:o.aceEditor();t&&t.setValue(u.value.code||"",-1)},Oe=e=>{u.value&&(u.value.code=e,m.value.code=e)},$e=()=>{var e;u.value&&((e=E.value)==null||e.addToEditor(u.value.code||""),G(),Ce())},Ue=e=>{if(!e||!e.functionNum||!e.data||e.data.length===0){y.value&&b.warn("Oscilloscope",`Invalid function table data for F${(e==null?void 0:e.functionNum)||"unknown"}`);return}const t=C[e.functionNum];if(!t){y.value&&b.warn("Oscilloscope",`Canvas not found for function table F${e.functionNum}`);return}const o=t.getContext("2d");if(!o){y.value&&b.warn("Oscilloscope",`Could not get 2D context for canvas F${e.functionNum}`);return}y.value&&b.debug("Oscilloscope",`Drawing function table F${e.functionNum} with ${e.data.length} points`);const s=t.width,a=t.height,c=e.data;o.clearRect(0,0,s,a),o.fillStyle="#1a1a1a",o.fillRect(0,0,s,a),o.strokeStyle="#333333",o.lineWidth=.5;for(let n=0;n<=s;n+=s/4)o.beginPath(),o.moveTo(n,0),o.lineTo(n,a),o.stroke();for(let n=0;n<=a;n+=a/2)o.beginPath(),o.moveTo(0,n),o.lineTo(s,n),o.stroke();o.strokeStyle="#555555",o.beginPath(),o.moveTo(0,a/2),o.lineTo(s,a/2),o.stroke();let f=1/0,r=-1/0;for(let n=0;n<c.length;n++)f=Math.min(f,c[n]),r=Math.max(r,c[n]);f===r&&(f-=.5,r+=.5),o.strokeStyle="#00ff00",o.lineWidth=1.5,o.beginPath();const g=c.length;try{for(let n=0;n<g;n++){const k=n/(g-1)*s,ye=(1-(c[n]-f)/(r-f))*a;n===0?o.moveTo(k,ye):o.lineTo(k,ye)}o.stroke(),o.fillStyle="#00ff00",o.font="9px monospace",o.fillText(`${r.toFixed(2)}`,2,8),o.fillText(`${f.toFixed(2)}`,2,a-2),o.fillText(`${g}p`,s-25,8)}catch(n){y.value&&b.error("Oscilloscope",`Error drawing oscilloscope for F${e.functionNum}:`,n)}},Ce=()=>{Object.keys(C).forEach(e=>{const t=C[e];if(t){const o=t.getContext("2d");o&&o.clearRect(0,0,t.width,t.height)}}),Object.keys(C).forEach(e=>{delete C[e]}),_.value=[],y.value&&b.debug("App","Cleared all oscilloscopes")};return(e,t)=>(v(),d("div",je,[l("div",qe,[l("button",{onClick:Le,class:"icon-button",title:P.value?"Hide Code":"Show Code"},[P.value?(v(),d("svg",Ge,t[12]||(t[12]=[l("path",{fill:"currentColor",d:"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"},null,-1)]))):(v(),d("svg",Je,t[13]||(t[13]=[l("path",{fill:"currentColor",d:"M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z"},null,-1)]))),M(te,{name:"title-fade"},{default:ee(()=>[B.value?(v(),d("span",Qe,A(B.value),1)):L("",!0)]),_:1})],8,We),l("button",{onClick:J,class:"icon-button",title:"Evaluate Binary (Ctrl+Enter)"},t[14]||(t[14]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M8,5.14V19.14L19,12.14L8,5.14Z"})],-1),l("span",{class:"f-subscript"},"F",-1)])),l("button",{onClick:F,class:"icon-button",title:"Evaluate TS (Alt+Enter)"},[(v(),d("svg",Xe,[V.value?(v(),d("path",tt)):(v(),d("path",et))])),t[15]||(t[15]=l("span",{class:"ts-subscript"},"TS",-1))]),l("button",{onClick:de,class:"icon-button",title:"Clear Editor (Ctrl+H)"},t[16]||(t[16]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,21V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})],-1)])),l("button",{onClick:xe,class:"icon-button",title:"Random Prompt"},t[17]||(t[17]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M14.83,13.41L13.42,14.82L16.55,17.95L14.5,20H20V14.5L17.96,16.54L14.83,13.41M14.5,4L16.54,6.04L4,18.59L5.41,20L17.96,7.46L20,9.5V4M10.59,9.17L5.41,4L4,5.41L9.17,10.58L10.59,9.17Z"})],-1)])),l("button",{onClick:t[0]||(t[0]=o=>Z.value=!0),class:"icon-button",title:"Help"},t[18]||(t[18]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"})],-1)])),l("button",{onClick:G,class:"icon-button",title:"Storage Menu (Ctrl+M)"},t[19]||(t[19]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)]))]),P.value?(v(),d("div",ot,[l("div",lt,[l("div",{class:"score-editor",style:he({flex:j.value})},[M(oe,{ref_key:"scoreEditorRef",ref:E,mode:"editor",value:yt,onEvaluate:J,onEvaluateTS:F,onKeydown:fe},null,512),l("div",at,[(v(!0),d(we,null,ke(_.value,(o,s)=>(v(),d("div",{key:s,class:"mini-oscilloscope"},[l("div",nt,"F"+A(o.functionNum),1),l("canvas",{ref_for:!0,ref:a=>{a&&(C[o.functionNum]=a)},width:"80",height:"50",class:"mini-oscilloscope-canvas"},null,512)]))),128))])],4),l("div",{class:"divider",onMousedown:Se},null,32),l("div",{class:"console-editor",style:he({flex:q.value})},[l("div",{class:"console-header"},[l("button",{class:"clear-btn",onClick:Q,title:"Clear console (Ctrl+P)"},"ðŸ—‘ï¸")]),M(oe,{ref_key:"consoleEditorRef",ref:T,mode:"terminal"},null,512)],4)])])):L("",!0),M(te,{"enter-active-class":"fadeIn","leave-active-class":"fadeOut",duration:3e3,mode:"out-in"},{default:ee(()=>[K.value?(v(),d("div",{class:"plot-display",key:be.value},[l("img",{src:`data:image/png;base64,${K.value}`,alt:"Plot",onClick:t[1]||(t[1]=o=>U.value=!0),class:"plot-image"},null,8,st)])):L("",!0)]),_:1}),M(te,{"enter-active-class":"fadeIn","leave-active-class":"fadeOut",duration:300},{default:ee(()=>[U.value?(v(),d("div",{key:0,class:"lightbox",onClick:t[4]||(t[4]=o=>U.value=!1)},[l("button",{class:"close-button",onClick:t[2]||(t[2]=D(o=>U.value=!1,["stop"]))},t[20]||(t[20]=[l("svg",{class:"icon",viewBox:"0 0 24 24"},[l("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)])),l("img",{src:`data:image/png;base64,${K.value}`,alt:"Plot",class:"lightbox-image",onClick:t[3]||(t[3]=D(()=>{},["stop"]))},null,8,it)])):L("",!0)]),_:1}),$.value?(v(),d("div",{key:1,class:"storage-menu",onClick:D(G,["self"])},[l("div",rt,[l("div",ut,[l("div",ct,[l("form",{onSubmit:D(Ae,["prevent"])},[R(l("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>m.value.title=o),placeholder:"Title",required:""},null,512),[[N,m.value.title]]),R(l("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=o=>m.value.year=o),placeholder:"Year",required:""},null,512),[[N,m.value.year,void 0,{number:!0}]]),R(l("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>m.value.composer=o),placeholder:"Composer",required:""},null,512),[[N,m.value.composer]]),R(l("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>m.value.comments=o),placeholder:"Comments",rows:"3",required:""},null,512),[[N,m.value.comments]]),t[21]||(t[21]=l("button",{type:"submit"},"[ Add ]",-1))],32)]),l("div",dt,[(v(!0),d(we,null,ke(p.value,(o,s)=>(v(),d("div",{key:s,class:Ie({selected:w.value===s}),onClick:a=>Fe(s)},A(o.composer)+" - "+A(o.year)+" - "+A(o.title||"Untitled"),11,vt))),128))])]),l("div",ft,[M(oe,{ref_key:"codeEditorRef",ref:h,mode:"editor",value:u.value?u.value.code:"",onInput:Oe},null,8,["value"]),l("div",pt,[l("button",{onClick:Ve},"[ Play TS ]"),l("button",{onClick:$e},"[ To Editor ]"),l("button",{onClick:t[9]||(t[9]=o=>He(w.value))},"[ Update ]"),l("button",{onClick:t[10]||(t[10]=o=>Pe(w.value))},"[ Delete ]")])])])])):L("",!0),l("div",mt,[S.value?(v(),d("div",gt,"Processing...")):L("",!0),ae.value?(v(),d("button",{key:1,onClick:F,class:"mobile-evaluate-btn",title:"Alt+Enter"},"Evaluate TS")):L("",!0)]),O.value?(v(),d("div",Ct,A(O.value),1)):L("",!0),M(ze,{modelValue:Z.value,"onUpdate:modelValue":t[11]||(t[11]=o=>Z.value=o)},null,8,["modelValue"])]))}},Lt=_e(ht,[["__scopeId","data-v-aae8d73d"]]);export{Lt as default};
